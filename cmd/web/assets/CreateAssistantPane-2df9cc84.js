import{_ as P}from"./ModelSelect.vue_vue_type_script_setup_true_lang-854043e9.js";import{d as S,r as _,k as C,Z as k,L as T,X as z,Y as N,W as n,F as $,a1 as b,au as A,x as U,c as j,U as B,l as q,m as l,j as r,n as M,al as D,am as L}from"./utils-15090c58.js";import{_ as F,J as R,V as E,a5 as J}from"./index-24ceeda1.js";import{V as W}from"./VRow-ab8e6ed5.js";import{I as X}from"./IconPlus-f64eaa99.js";import{V as x}from"./VTextarea-b1274484.js";import{V as Y}from"./VForm-123b6ecf.js";const Z=["accept"],G=S({__name:"CustomUpload",props:{limit:{default:1},fileSize:{default:2},fileType:{default:()=>[]}},emits:["before-upload","after-upload","upload-success"],setup(u,{expose:y,emit:w}){const p=u,v=w,d=_(!1),e=_(),m=()=>{e.value.click()},h=a=>{const c=a.target.files[0];c&&g(c)},g=async a=>{if(e.value.value=null,!p.fileType.includes(a.type)){b.warning("上传文件不符合所需的格式！");return}if(a.size/1024/1024>p.fileSize){b.warning(`上传文件大小不能超过 ${p.fileSize}M！`);return}d.value=!0,v("before-upload",a);const[f,c]=await A.upload({url:"/files",data:{file:a}});d.value=!1,v("after-upload",{err:f,res:c})};return y({handleSelectFile:m}),(a,f)=>(C(),k($,null,[a.$slots.trigger?(C(),k("a",T({key:0,href:"javascript: void(0)",onClick:m},a.$attrs),[z(a.$slots,"trigger",{loading:d.value},void 0,!0)],16)):N("",!0),n("input",{ref_key:"refUpload",ref:e,accept:a.fileType.join(","),class:"hide",type:"file",onChange:h},null,40,Z)],64))}});const H=F(G,[["__scopeId","data-v-a53cb1da"]]),V=u=>(D("data-v-f06a51fd"),u=u(),L(),u),K={class:"mx-auto mt-3",style:{width:"540px"}},O={class:"avatar position-relative"},Q=["src"],ee={class:"avatar-add-btn"},ae=V(()=>n("label",{class:"required"},"助手名称",-1)),te=V(()=>n("label",null,"指令",-1)),se=V(()=>n("label",{class:"required"},"模型",-1)),oe=V(()=>n("label",null,"备注",-1)),le=S({__name:"CreateAssistantPane",emits:["submit"],setup(u,{expose:y,emit:w}){const p={avatar:"",name:"",instructions:"",modelName:null,remark:""},v=w,d=U({operateType:"add"}),e=_({...p}),m=_(),h=_(),g=U({name:[s=>!!s||"请输入助手名称"],modelName:[s=>!!s||"请选择模型"]}),a=j(()=>e.value.avatar||new URL("/assets/defaultAvatar-35ab597a.png",self.location).href),f=({res:s})=>{s&&(e.value.avatar=s.s3Url)},c=async({valid:s,showLoading:t})=>{if(s){const o={url:"",method:""};d.operateType=="add"?(o.url="/assistants/create",o.method="post"):(o.url=`/assistants/${e.value.assistantId}`,o.method="put");const[i,I]=await A[o.method]({showLoading:t,showSuccess:!0,url:o.url,data:e.value});I&&(m.value.hide(),v("submit"))}};return y({show({title:s,operateType:t,infos:o}){m.value.show({title:s,refForm:h}),d.operateType=t,d.operateType==="add"?e.value={...p}:e.value={...o}}}),(s,t)=>{const o=B("Pane");return C(),q(o,{ref_key:"refPane",ref:m,onSubmit:c},{default:l(()=>[n("div",K,[r(Y,{ref_key:"refForm",ref:h,class:"my-form"},{default:l(()=>[r(W,{class:"justify-center"},{default:l(()=>[n("div",O,[r(R,{size:"100"},{default:l(()=>[n("img",{src:a.value,width:"100",alt:"avatar"},null,8,Q)]),_:1}),r(H,{"file-type":["image/jpeg","image/png","image/jpg"],"file-size":5,onAfterUpload:f},{trigger:l(()=>[n("div",ee,[r(E,{icon:"",flat:"",color:"info",size:"x-small"},{default:l(()=>[r(M(X),{"stroke-width":"2.5",size:20})]),_:1})])]),_:1})])]),_:1}),r(J,{type:"text",placeholder:"请输入助手名称","hide-details":"auto",clearable:"",rules:g.name,modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=i=>e.value.name=i)},{prepend:l(()=>[ae]),_:1},8,["rules","modelValue"]),r(x,{modelValue:e.value.instructions,"onUpdate:modelValue":t[1]||(t[1]=i=>e.value.instructions=i),modelModifiers:{trim:!0},"hide-details":"auto",placeholder:"请输入给AI的指令"},{prepend:l(()=>[te]),_:1},8,["modelValue"]),r(P,{placeholder:"请选择模型",rules:g.modelName,modelValue:e.value.modelName,"onUpdate:modelValue":t[2]||(t[2]=i=>e.value.modelName=i),"hide-details":"auto"},{prepend:l(()=>[se]),_:1},8,["rules","modelValue"]),r(x,{modelValue:e.value.remark,"onUpdate:modelValue":t[3]||(t[3]=i=>e.value.remark=i),modelModifiers:{trim:!0},placeholder:"请输入备注"},{prepend:l(()=>[oe]),_:1},8,["modelValue"])]),_:1},512)])]),_:1},512)}}});const ce=F(le,[["__scopeId","data-v-f06a51fd"]]);export{ce as C};
