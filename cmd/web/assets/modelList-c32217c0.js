import{d as E,x as A,z as K,r as v,aA as ce,aw as Y,a8 as L,U as g,k as F,l as H,m as l,W as _,j as e,n as t,_ as r,Y as R,al as ee,am as le,au as S,Q as _e,a3 as be,at as ye,ax as Ve,o as he,Z as z,av as ve,$ as Q,F as xe}from"./utils-15090c58.js";import{_ as ge}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-f6213a89.js";import{_ as ke}from"./UiParentCard.vue_vue_type_script_setup_true_lang-0e150107.js";import{A as we}from"./AlertBlock-c06c49ed.js";import{C as J}from"./ChipBoolean-c6a17e6f.js";import{C as Ne}from"./ChipStatus-64ab7576.js";import{_ as k}from"./Explain.vue_vue_type_style_index_0_lang-9177768e.js";import{c as Te,a5 as M,_ as te,V as G,am as Ce}from"./index-24ceeda1.js";import{V as W}from"./VSwitch-83b6bbc0.js";import{V as Pe}from"./VTextarea-b1274484.js";import{V as ae}from"./VForm-123b6ecf.js";import{V as O}from"./VCheckbox-3e0659d6.js";import{_ as $e}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-77722b42.js";import{_ as De}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-3456f2c5.js";import{V as C}from"./VCol-e2fcfa86.js";import{V as X}from"./VRow-ab8e6ed5.js";import"./IconInfoCircle-03c84ef6.js";import"./VAlert-30650f94.js";import"./Confirm-aedf99ab.js";var Ie=Te("messages","IconMessages",[["path",{d:"M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10",key:"svg-0"}],["path",{d:"M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2",key:"svg-1"}]]);const j=x=>(ee("data-v-50950469"),x=x(),le(),x),Ue={class:"mx-auto mt-10",style:{width:"500px"}},Se=j(()=>_("label",{class:"required"},"模型名称",-1)),Me=j(()=>_("label",{class:"required"},"最长上下文",-1)),Fe={class:"required"},Be={class:"required",style:{width:"100%"}},qe=j(()=>_("label",null,"备注",-1)),Qe=E({__name:"PaneModel",emits:["submit"],setup(x,{expose:P,emit:B}){const a=A({operateType:"add",disabledField:!1,maxTokens:5e5,formData:{id:"",modelName:"",maxTokens:0,isPrivate:!1,isFineTuning:!1,enabled:!0,remark:"",parameters:0,providerName:""}}),{formData:s}=K(a),c=B,w=v(),$=v(),V=A({modelName:[b=>ce.isModelName({value:b,required:!0})],maxTokens:[b=>b!==""?b<1?"下限 1":b>a.maxTokens?"上限 "+Y.commaString(a.maxTokens):!0:"请输入模型最长上下文"],providerName:[b=>b&&b.length>0?!0:"请选择供应"]}),N=async(b={})=>{const[u,o]=await S.post({...b,showSuccess:!0,url:"/models",data:{...a.formData}});o&&(w.value.hide(),c("submit"))},h=async(b={})=>{const[u,o]=await S.put({...b,showSuccess:!0,url:`/models/${a.formData.id}`,data:{...a.formData}});o&&(w.value.hide(),c("submit"))},D=({valid:b,showLoading:u})=>{b&&(a.operateType=="add"?N({showLoading:u}):h({showLoading:u}))};return P({show({title:b,infos:u={id:"",modelName:"",maxTokens:0,isPrivate:!1,isFineTuning:!1,enabled:!0,remark:"",providerName:"",parameters:0},operateType:o}){w.value.show({title:b,refForm:$}),a.formData=L.pick(L.cloneDeep(u),["id","modelName","maxTokens","isPrivate","isFineTuning","enabled","remark","providerName","parameters"]),a.operateType=o,o=="add"?a.disabledField=!1:a.disabledField=!0}}),(b,u)=>{const o=g("Select"),d=g("Pane");return F(),H(d,{ref_key:"refPane",ref:w,class:"",onSubmit:D},{default:l(()=>[_("div",Ue,[e(ae,{ref_key:"refForm",ref:$,class:"my-form"},{default:l(()=>[e(M,{density:"compact",variant:"outlined",type:"text",placeholder:"只允许字母、数字、“-” 、“.” 和 “:” ","hide-details":"auto",clearable:"",rules:V.modelName,modelValue:t(s).modelName,"onUpdate:modelValue":u[0]||(u[0]=f=>t(s).modelName=f),disabled:a.disabledField},{prepend:l(()=>[Se]),_:1},8,["rules","modelValue","disabled"]),e(M,{density:"compact",variant:"outlined",type:"number",placeholder:"上限 "+t(Y).commaString(a.maxTokens),"hide-details":"auto",rules:V.maxTokens,modelValue:t(s).maxTokens,"onUpdate:modelValue":u[1]||(u[1]=f=>t(s).maxTokens=f),modelModifiers:{number:!0}},{prepend:l(()=>[Me]),_:1},8,["placeholder","rules","modelValue"]),e(o,{placeholder:"请选择供应商",rules:V.providerName,mapDictionary:{code:"model_provider_name"},modelValue:t(s).providerName,"onUpdate:modelValue":u[2]||(u[2]=f=>t(s).providerName=f),disabled:a.disabledField},{prepend:l(()=>[_("label",Fe,[r("供应 "),e(k,null,{default:l(()=>[r("供应商指的是外部服务提供，自己有服务请选择Local")]),_:1})])]),_:1},8,["rules","modelValue","disabled"]),e(W,{modelValue:t(s).isPrivate,"onUpdate:modelValue":u[3]||(u[3]=f=>t(s).isPrivate=f),disabled:a.disabledField,color:"primary","hide-details":"auto"},{prepend:l(()=>[_("label",null,[r("私有 "),e(k,null,{default:l(()=>[r("私有模型，表示部署在本地服务器，如果是请打开")]),_:1})])]),_:1},8,["modelValue","disabled"]),e(W,{modelValue:t(s).isFineTuning,"onUpdate:modelValue":u[4]||(u[4]=f=>t(s).isFineTuning=f),disabled:a.disabledField,color:"primary","hide-details":"auto"},{prepend:l(()=>[_("label",null,[r("微调 "),e(k,null,{default:l(()=>[r("是否是微调模型")]),_:1})])]),_:1},8,["modelValue","disabled"]),e(W,{modelValue:t(s).enabled,"onUpdate:modelValue":u[5]||(u[5]=f=>t(s).enabled=f),color:"primary","hide-details":"auto"},{prepend:l(()=>[_("label",null,[r("启用 "),e(k,null,{default:l(()=>[r("模型是否可被使用，如果关闭则无法使用该模型")]),_:1})])]),_:1},8,["modelValue"]),t(s).isPrivate?(F(),H(M,{key:0,density:"compact",variant:"outlined",type:"number",placeholder:"请输入参数量","hide-details":"auto",modelValue:t(s).parameters,"onUpdate:modelValue":u[6]||(u[6]=f=>t(s).parameters=f),modelModifiers:{number:!0},style:{width:"60%"},disabled:a.disabledField},{prepend:l(()=>[_("label",Be,[r("参数量(B) "),e(k,null,{default:l(()=>[r("单位是B，代理10亿")]),_:1})])]),_:1},8,["modelValue","disabled"])):R("",!0),e(Pe,{modelValue:t(s).remark,"onUpdate:modelValue":u[7]||(u[7]=f=>t(s).remark=f),modelModifiers:{trim:!0},placeholder:"请输入"},{prepend:l(()=>[qe]),_:1},8,["modelValue"])]),_:1},512)])]),_:1},512)}}});const Ae=te(Qe,[["__scopeId","data-v-50950469"]]),oe=x=>(ee("data-v-f887bf9f"),x=x(),le(),x),Le={class:"mx-auto mt-10",style:{width:"500px"}},ze=oe(()=>_("label",{class:"required"},"模型名称",-1)),Ge={class:"required"},We={class:"required"},Ye={class:"required"},He=oe(()=>_("label",null,null,-1)),Re=E({__name:"ArrangeModel",emits:["submit"],setup(x,{expose:P,emit:B}){const a=/^\+?[1-9][0-9]*$/,s=A({operateType:"",maxTokens:5e5,id:"",modelName:"",isQuantify:!1,formData:{replicas:"",label:"",gpu:"",quantization:"",vllm:""}}),{formData:c,id:w}=K(s),$=B,V=v(),N=v(),h=(o,d,f,I,p=!1)=>o!==""?o<d?`下限 ${d}`:o>f?`上限 ${f}`:p&&a.test(o)!=!0?"请输入正整数":!0:I,D=A({replicas:[o=>h(o,1,8,"请输入实例数量",!0)],label:[o=>!!o||"请选择调度标签"],gpu:[o=>h(o,1,8,"请输入GPU数量",!0)],quantization:[o=>!!o||"请选择精度"],isQuantify:[o=>o&&o!=!1?!0:"请开启量化"],vllm:[o=>o&&o!=!1?!0:"请开启VLLM"]}),b=async(o={})=>{s.formData.quantization=s.isQuantify?"float16":""},u=async({valid:o,showLoading:d})=>{if(o){const[f,I]=await S.post({...d,showSuccess:!0,url:`/api/models/${s.id}/deploy`,data:{...s.formData}});I&&(V.value.hide(),$("submit"))}};return P({show({title:o,infos:d={id:"",modelName:""},operateType:f}){V.value.show({title:o,refForm:N}),s.formData=L.pick(L.cloneDeep(d),[]),s.operateType=f,s.modelName=d.modelName,s.id=d.id}}),(o,d)=>{const f=g("Select"),I=g("Pane");return F(),H(I,{ref_key:"refPane",ref:V,class:"",onSubmit:u},{default:l(()=>[_("div",Le,[e(ae,{ref_key:"refForm",ref:N,class:"my-form"},{default:l(()=>[e(M,{"hide-details":"auto",modelValue:s.modelName,"onUpdate:modelValue":d[0]||(d[0]=p=>s.modelName=p),disabled:!0},{prepend:l(()=>[ze]),_:1},8,["modelValue"]),e(M,{type:"number","hide-details":"auto",placeholder:"请输入使用实例数量",rules:D.replicas,modelValue:t(c).replicas,"onUpdate:modelValue":d[1]||(d[1]=p=>t(c).replicas=p),modelModifiers:{number:!0},onInput:d[2]||(d[2]=p=>h(t(c).replicas,1,8,"请输入实例数量",!0)),max:"8"},{prepend:l(()=>[_("label",Ge,[r("实例数 "),e(k,null,{default:l(()=>[r("启动实例数量")]),_:1})])]),_:1},8,["rules","modelValue"]),e(f,{"hide-details":"auto",placeholder:"请选择调度标签",rules:D.label,mapDictionary:{code:"model_deploy_label"},modelValue:t(c).label,"onUpdate:modelValue":d[3]||(d[3]=p=>t(c).label=p)},{prepend:l(()=>[_("label",We,[r("调度标签 "),e(k,null,{default:l(()=>[r("设置实例调度的节点亲和性")]),_:1})])]),_:1},8,["rules","modelValue"]),e(M,{"hide-details":"auto",type:"number",placeholder:"请输入使用GPU数量",rules:D.gpu,modelValue:t(c).gpu,"onUpdate:modelValue":d[4]||(d[4]=p=>t(c).gpu=p),modelModifiers:{number:!0},onInput:d[5]||(d[5]=p=>h(t(c).gpu,1,8,"请输入GPU数量",!0)),max:"8"},{prepend:l(()=>[_("label",Ye,[r("GPU数量 "),e(k,null,{default:l(()=>[r("单实例GPU数量")]),_:1})])]),_:1},8,["rules","modelValue"]),e(O,{"hide-details":"auto",label:"开启量化",modelValue:s.isQuantify,"onUpdate:modelValue":d[6]||(d[6]=p=>s.isQuantify=p),onChange:b},{prepend:l(()=>[_("label",null,[r("量化 "),e(k,null,{default:l(()=>[r("对模型启动进行量化，节约显存提升推理速度")]),_:1})])]),_:1},8,["modelValue"]),_e(e(f,{placeholder:"请选择精度",mapDictionary:{code:"model_deploy_quantization"},modelValue:t(c).quantization,"onUpdate:modelValue":d[7]||(d[7]=p=>t(c).quantization=p),style:{"margin-top":"-14px"}},{prepend:l(()=>[He]),_:1},8,["modelValue"]),[[be,s.isQuantify]]),e(O,{style:{"margin-top":"-14px"},"hide-details":"auto",label:"开启VLLM",modelValue:t(c).vllm,"onUpdate:modelValue":d[8]||(d[8]=p=>t(c).vllm=p)},{prepend:l(()=>[_("label",null,[r("VLLM "),e(k,null,{default:l(()=>[r("如果想要高吞吐量批量处理，您可以尝试开启，开启后会占用gpu的所有显存容量")]),_:1})])]),_:1},8,["modelValue"])]),_:1},512)])]),_:1},512)}}});const Ee=te(Re,[["__scopeId","data-v-f887bf9f"]]),Ke=["onClick"],je={key:0,style:{width:"80px"},class:"mx-auto mb-4"},Ze=_("span",{class:"text-body-2 text-lightText"},"部署中",-1),Je={key:1},Oe={class:"text-primary font-weight-black"},Xe=_("br",null,null,-1),el=_("br",null,null,-1),ll=["innerHTML"],xl=E({__name:"modelList",setup(x){const P=ye(),B=Ve(),a=A({style:{},formData:{modelName:"",isPrivate:null,enabled:null,providerName:null},selectedInfo:{id:"",modelName:""},tableInfos:{list:[],total:""},confirmByClickInfo:{html:"",action:"",row:{}}}),{style:s,formData:c}=K(a),w=v(),$=v(),V=v(),N=v(),h=v(),D=v({title:"模型列表"}),b=v([{text:"模型管理",disabled:!1,href:"#"},{text:"模型列表",disabled:!0,href:"#"}]),u=({id:i,modelName:m}={})=>{m?P.push("/model/chat-playground?modelName="+m+"&modelId="+i):P.push("/model/chat-playground")},o=({id:i,modelName:m})=>{P.push(`/model/model-list/detail?jobId=${i}&modelName=`+m)},d=i=>{let m=[];for(let y of i.operation)y=="edit"?m.push({text:"编辑",color:"info",click(){re(i)}}):y=="delete"?m.push({text:"删除",color:"error",click(){se(i)}}):y=="deploy"?m.push({text:"部署",color:"info",click(){$.value.show({title:"部署模型",infos:i})}}):y=="undeploy"&&m.push({text:"卸载",color:"info",click(){L.assign(a.confirmByClickInfo,{html:"确认卸载模型 <span class='text-primary mx-1  font-weight-black'>"+i.modelName+"</span>吗？",action:"undeploy",row:i}),h.value.show({width:"350px"})}});return m},f=(i={})=>{let{action:m,row:y}=a.confirmByClickInfo;m=="deploy"?ie(y,i):m=="undeploy"&&ue(y,i)},I=async(i={})=>{const[m,y]=await S.get({url:"/models",showLoading:N.value.el,data:{...a.formData,...i}});y?(a.tableInfos.list=y.list,a.tableInfos.total=y.total):(a.tableInfos.list=[],a.tableInfos.total=0)},p=()=>{N.value.query({page:1})},Z=()=>{N.value.query()},se=i=>{a.selectedInfo=i,V.value.show({width:"400px",confirmText:a.selectedInfo.modelName})},de=async(i={})=>{const[m,y]=await S.delete({...i,showSuccess:!0,url:`/api/models/${a.selectedInfo.id}`});y&&(V.value.hide(),p())},ne=()=>{w.value.show({title:"添加模型",operateType:"add"})},re=i=>{w.value.show({title:"编辑模型",infos:i,operateType:"edit"})},ie=async(i,m)=>{let[y,q]=await S.post({...m,showSuccess:!0,url:`/api/models/${i.id}/deploy`});q&&(h.value.hide(),Z())},ue=async(i,m)=>{let[y,q]=await S.post({...m,showSuccess:!0,url:`/api/models/${i.id}/undeploy`});q&&(h.value.hide(),Z())};return he(()=>{let{modelName:i}=B.query;i&&(a.formData.modelName=i),p()}),(i,m)=>{const y=g("Select"),q=g("ButtonsInForm"),me=g("el-tooltip"),T=g("el-table-column"),pe=g("ButtonsInTable"),fe=g("TableWithPager");return F(),z(xe,null,[e(ge,{title:D.value.title,breadcrumbs:b.value},null,8,["title","breadcrumbs"]),e(X,null,{default:l(()=>[e(C,null,{default:l(()=>[e(ke,null,{default:l(()=>[e(X,null,{default:l(()=>[e(C,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[e(M,{density:"compact",modelValue:t(c).modelName,"onUpdate:modelValue":m[0]||(m[0]=n=>t(c).modelName=n),label:"搜索模型名称","hide-details":"",clearable:"",variant:"outlined",color:"red",onKeyup:ve(p,["enter"]),"onClick:clear":p},null,8,["modelValue","onKeyup"])]),_:1}),e(C,{cols:"12",lg:"2",md:"2",sm:"6"},{default:l(()=>[e(y,{onChange:p,label:"是否私有",mapDictionary:{code:"boolean"},modelValue:t(c).isPrivate,"onUpdate:modelValue":m[1]||(m[1]=n=>t(c).isPrivate=n)},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",lg:"2",md:"2",sm:"6"},{default:l(()=>[e(y,{onChange:p,label:"请选择状态",mapDictionary:{code:"local_enabled"},modelValue:t(c).enabled,"onUpdate:modelValue":m[2]||(m[2]=n=>t(c).enabled=n)},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",lg:"2",md:"2",sm:"6"},{default:l(()=>[e(y,{onChange:p,label:"请选择供应",mapDictionary:{code:"model_provider_name"},modelValue:t(c).providerName,"onUpdate:modelValue":m[3]||(m[3]=n=>t(c).providerName=n)},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",lg:"3",md:"3",sm:"6"},{default:l(()=>[e(q,null,{default:l(()=>[e(G,{color:"primary",onClick:u},{default:l(()=>[r("聊天操场")]),_:1}),e(G,{color:"primary",onClick:ne},{default:l(()=>[r("添加模型")]),_:1})]),_:1})]),_:1}),e(C,{cols:"12"},{default:l(()=>[e(we,null,{default:l(()=>[r(" 修改之后将实时生效，请谨慎操作！ ")]),_:1})]),_:1}),e(C,{cols:"12"},{default:l(()=>[e(fe,{onQuery:I,ref_key:"refTableWithPager",ref:N,infos:a.tableInfos},{default:l(()=>[e(T,{label:"模型",width:"200px",fixed:"left"},{default:l(({row:n})=>[e(me,{content:"查看详情",placement:"top"},{default:l(()=>[_("span",{class:"link",onClick:U=>o(n)},Q(n.modelName),9,Ke)]),_:2},1024)]),_:1}),e(T,{label:"最长上下文",width:"110px"},{default:l(({row:n})=>[_("span",null,Q(n.maxTokens),1)]),_:1}),e(T,{label:"是否启用","min-width":"100px"},{default:l(({row:n})=>[e(Ne,{modelValue:n.enabled,"onUpdate:modelValue":U=>n.enabled=U},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(T,{label:"是否私有","min-width":"100px"},{default:l(({row:n})=>[e(J,{modelValue:n.isPrivate,"onUpdate:modelValue":U=>n.isPrivate=U},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(T,{label:"是否微调","min-width":"100px"},{default:l(({row:n})=>[e(J,{modelValue:n.isFineTuning,"onUpdate:modelValue":U=>n.isFineTuning=U},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(T,{label:"部署","min-width":"150px"},{default:l(({row:n})=>[n.deployStatus=="pending"?(F(),z("div",je,[e(Ce,{height:"24",striped:"",indeterminate:"",color:"#4eb879",rounded:"",class:"mx-auto"},{default:l(()=>[Ze]),_:1})])):R("",!0),n.enabled?(F(),z("div",Je,[e(G,{onClick:U=>u(n),"prepend-icon":"mdi-chat",size:"small",variant:"outlined",color:"info"},{prepend:l(()=>[e(t(Ie),{size:16})]),default:l(()=>[r(" 对话 ")]),_:2},1032,["onClick"])])):R("",!0)]),_:1}),e(T,{label:"备注","min-width":"200px","show-overflow-tooltip":""},{default:l(({row:n})=>[r(Q(n.remark),1)]),_:1}),e(T,{label:"更新时间","min-width":"200px"},{default:l(({row:n})=>[r(Q(t(Y).dateFormat(n.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(T,{label:"操作","min-width":"120px",fixed:"right"},{default:l(({row:n})=>[e(pe,{buttons:d(n)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Ae,{ref_key:"refPaneModel",ref:w,onSubmit:p},null,512),e(Ee,{ref_key:"refArrangeModel",ref:$,onSubmit:p},null,512),e($e,{ref_key:"refConfirmDelete",ref:V,onSubmit:de},{text:l(()=>[r(" 您将要删除 "),_("span",Oe,Q(a.selectedInfo.modelName),1),r(" 模型，删除之后，"),Xe,r(" 若有使用该模型的应用场景都将取消授权。 "),el,r("确定要继续吗？ ")]),_:1},512),e(De,{ref_key:"refConfirmByClick",ref:h,onSubmit:f},{text:l(()=>[_("div",{innerHTML:a.confirmByClickInfo.html},null,8,ll)]),_:1},512)],64)}}});export{xl as default};
