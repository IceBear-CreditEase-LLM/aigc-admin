import{u as Z}from"./useScroll-48970cb6.js";import{_ as G}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-37f0c715.js";import{d as J,au as K,r as u,x as Q,c as X,k as x,l as O,m as l,j as e,_,Z as A,a5 as z,F as I,$ as ee,W as m,U as te,Y as ae,av as oe,al as se,am as ne}from"./utils-b25c068e.js";import{_ as le}from"./ModelSelect.vue_vue_type_script_setup_true_lang-61d1aad8.js";import{a4 as U,a5 as F,L as j,a0 as re,_ as de}from"./index-54ead634.js";import{V as E}from"./VSlider-de23111e.js";import{V as M}from"./VSheet-4c85d4f3.js";import{S as ue,M as me}from"./index-83d63197.js";import{_ as ce}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-9e4a955a.js";import{V as ie}from"./VAlert-a57f3454.js";import{V as pe}from"./VTextarea-896dc9a7.js";import"./favicon-fa2da43f.js";import"./Confirm-17fe4b61.js";const fe=m("h6",{class:"text-h6 mb-3"},"会话设置",-1),_e=J({__name:"Config",setup(V,{expose:$}){const C=K(),{modelName:w}=C.query,i=u(10),c=u(w?{modelName:w}:null),t=Q({maxTokens:512,temperature:0,topP:0}),h=X(()=>{var o;return[{key:"maxTokens",title:"最大响应数",max:((o=c.value)==null?void 0:o.maxTokens)??0,min:0,step:1},{key:"temperature",title:"温度",max:1,min:0,step:.1},{key:"topP",title:"TopP",max:1,min:0,step:.1}]}),k=d=>{const o=d.maxTokens;t.maxTokens=t.maxTokens>o?o:512};return $({getData:()=>{var d;return{sendHistoryCount:i.value,data:{model:(d=c.value)==null?void 0:d.modelName,...t}}}}),(d,o)=>(x(),O(M,null,{default:l(()=>[e(U,{class:"mb-2 font-weight-medium"},{default:l(()=>[_("模型")]),_:1}),e(le,{modelValue:c.value,"onUpdate:modelValue":[o[0]||(o[0]=a=>c.value=a),k],"default-first-value":"","return-object":""},null,8,["modelValue"]),e(M,null,{default:l(()=>[fe,e(U,{class:"mb-2 font-weight-medium"},{default:l(()=>[_("包含过去的消息")]),_:1}),e(E,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=a=>i.value=a),color:"primary",max:20,min:0,step:"1","hide-details":"","thumb-label":""},{append:l(()=>[e(F,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=a=>i.value=a),modelModifiers:{number:!0},"hide-details":"","single-line":"",density:"compact",type:"number",max:20,min:0,style:{width:"80px"}},null,8,["modelValue"])]),_:1},8,["modelValue"]),(x(!0),A(I,null,z(h.value,a=>(x(),A(I,null,[e(U,{class:"mb-2 font-weight-medium"},{default:l(()=>[_(ee(a.title),1)]),_:2},1024),e(E,{modelValue:t[a.key],"onUpdate:modelValue":T=>t[a.key]=T,color:"primary",max:a.max,min:a.min,step:a.step,"hide-details":"","thumb-label":""},{append:l(()=>[e(F,{modelValue:t[a.key],"onUpdate:modelValue":T=>t[a.key]=T,modelModifiers:{number:!0},"hide-details":"","single-line":"",density:"compact",type:"number",max:a.max,min:a.min,step:a.step,style:{width:"80px"}},null,8,["modelValue","onUpdate:modelValue","max","min","step"])]),_:2},1032,["modelValue","onUpdate:modelValue","max","min","step"])],64))),256))]),_:1})]),_:1}))}}),P=V=>(se("data-v-22e7e8a0"),V=V(),ne(),V),he={class:"chat-playground d-flex"},ge={class:"left-part pa-4 d-none d-md-block"},ye=P(()=>m("h4",{class:"text-h6 mb-6"},"助理设置",-1)),ve=P(()=>m("br",null,null,-1)),xe={class:"middle-part"},Ve=P(()=>m("h4",{class:"text-h6 pa-4"},"聊天会话",-1)),ke={class:"right-part pa-4"},Te=P(()=>m("h4",{class:"text-h6 mb-6"},"配置",-1)),be=J({__name:"chatPlayground",setup(V){const{scrollRef:$,scrollToBottom:C,scrollToBottomIfAtBottom:w}=Z(),i=u({title:"聊天操场"}),c=u(""),t=u([]),h=u(""),k=u(!1),B=u(),d=u(),o=()=>{const s=h.value;h.value="",a("text",s)},a=async(s,n,g={})=>{let r=n;const y=T(r);N({content:r,contentType:s,createdAt:new Date,ext:g,msgType:"question"}),C(),k.value=!0,N({loading:!0,content:"",contentType:"text",createdAt:new Date,msgType:"answer"}),C();try{await oe.post({url:"/channels/chat/completions",timeout:300*1e3,data:y,onDownloadProgress:p=>{const S=p.target,{responseText:v}=S,q=v.lastIndexOf(`
`,v.length-2);let H=v;q!==-1&&(H=v.substring(q));try{const b=JSON.parse(H),D=t.value.length-1;if(b.success){const f=b.data;L(D,{loading:!0,content:f.fullContent,contentType:f.contentType??"text",createdAt:f.createdAt,msgType:"answer"})}else{const f=t.value[D];if(f.content&&f.content!==""){R(D,{content:`${f.content}
[${b.message}]`,loading:!0});return}L(D,{loading:!0,content:b.message,contentType:"text",createdAt:new Date,msgType:"answer"})}w()}catch{}}})}catch(p){console.log(p)}finally{R(t.value.length-1,{loading:!1}),k.value=!1}},T=s=>{const n=B.value.getData(),g=n.data,r=n.sendHistoryCount*2;let y=[];const p=[{role:"system",content:c.value}];return r!==0&&(y=t.value.slice(-r)),y.forEach(S=>{const v=S.msgType==="question"?"user":"assistant";p.push({role:v,content:S.content})}),p.push({role:"user",content:s}),g.messages=p,g},N=s=>{t.value.push(s)},L=(s,n)=>{t.value[s]=n},R=(s,n)=>{t.value[s]={...t.value[s],...n}},W=()=>{d.value.show({width:"400px"})},Y=()=>{t.value=[],d.value.hide()};return(s,n)=>{const g=te("perfect-scrollbar");return x(),A(I,null,[e(G,{title:i.value.title},null,8,["title"]),e(re,{elevation:"10"},{default:l(()=>[m("div",he,[m("div",ge,[ye,e(ie,{class:"mb-3 text-body-2",color:"textPrimary",variant:"tonal"},{default:l(()=>[_("给模型提供指令，告诉它在生成响应时应该如何行为以及需要参考的上下文。你可以描述助手的个性，告诉它应该回答什么和不应该回答什么，并告诉它如何格式化响应。此部分没有令牌限制，但将包含在每个API调用中，因此会计入总令牌限制。"),ve,_('比如："你是一个 AI 助手，可帮助人们查找信息并以押韵的方式作出回应。如果用户问了你不知道答案的问题，就说出来。"')]),_:1}),e(M,null,{default:l(()=>[e(U,{class:"mb-2 font-weight-medium"},{default:l(()=>[_("系统消息")]),_:1}),e(pe,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=r=>c.value=r),variant:"outlined",placeholder:"可以给定助理角色及相关要求，不要超过2000个字",rows:"3","no-resize":"",color:"primary","row-height":"25",shaped:"","hide-details":""},null,8,["modelValue"])]),_:1})]),m("div",xe,[Ve,e(j),e(g,{ref_key:"scrollRef",ref:$,class:"middle-part__list"},{default:l(()=>[t.value.length>0?(x(!0),A(I,{key:0},z(t.value,(r,y)=>(x(),O(me,{key:y,"chat-item":r},null,8,["chat-item"]))),128)):ae("",!0)]),_:1},512),e(j),e(ue,{modelValue:h.value,"onUpdate:modelValue":n[1]||(n[1]=r=>h.value=r),onSubmit:o,onClear:W,"send-loading":k.value},null,8,["modelValue","send-loading"])]),m("div",ke,[Te,e(_e,{ref_key:"configRef",ref:B},null,512)])])]),_:1}),e(ce,{ref_key:"refConfirmDelete",ref:d,onSubmit:Y},{text:l(()=>[_("确定清空会话？")]),_:1},512)],64)}}});const Re=de(be,[["__scopeId","data-v-22e7e8a0"]]);export{Re as default};
