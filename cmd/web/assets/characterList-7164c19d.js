import{d as ne,at as fe,r as p,U as q,k as h,l as V,m as e,j as t,W as n,$ as b,_ as i,n as r,aw as P,au as z,ac as de,x as H,z as _e,a8 as ee,V as te,Z as T,Y as he,al as re,am as ie,o as ve,av as ge,a0 as Z,F as J,a5 as ae,O as ye,Q as be,a3 as Ve}from"./utils-15090c58.js";import{_ as we}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-f6213a89.js";import{_ as G}from"./UiParentCard.vue_vue_type_script_setup_true_lang-0e150107.js";import{A as ke}from"./AlertBlock-c06c49ed.js";import{_ as xe}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-3456f2c5.js";import{c as Ie,ai as x,J as ue,V as Y,_ as ce,ak as le,M as me,am as $e,a5 as j,a0 as De,ax as Fe,K as Ce,I as Se,i as Pe,f as Ue,ay as Me}from"./index-24ceeda1.js";import{V as D}from"./VCol-e2fcfa86.js";import{V as X}from"./VRow-ab8e6ed5.js";import{_ as Le}from"./DialogLog.vue_vue_type_style_index_0_lang-d72a4ceb.js";import{_ as W}from"./Explain.vue_vue_type_style_index_0_lang-9177768e.js";import{_ as oe}from"./UploadFile.vue_vue_type_script_setup_true_lang-4cfa6d0e.js";import{V as se}from"./VAlert-30650f94.js";import{V as Ae}from"./VTextarea-b1274484.js";import{V as Ne}from"./VForm-123b6ecf.js";import{I as qe,a as ze,b as Ye}from"./IconEye-b3d51ee3.js";import"./IconInfoCircle-03c84ef6.js";import"./Confirm-aedf99ab.js";import"./TextLog-183c7d6e.js";import"./VFileInput-01190dfb.js";var Be=Ie("markdown","IconMarkdown",[["path",{d:"M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M7 15v-6l2 2l2 -2v6",key:"svg-1"}],["path",{d:"M14 13l2 2l2 -2m-2 2v-6",key:"svg-2"}]]);const Ee={style:{"aspect-ratio":"1"}},Re=["src","poster"],Te={class:"my-form"},je={class:"text-h3 my-2"},He=n("label",null,"头像：",-1),Qe={class:"d-flex align-center"},Ke=["src"],Oe=n("label",null,"时长：",-1),Ze=n("label",null,"大小：",-1),Je=n("label",null,"创建时间：",-1),We=n("label",null,"更新时间：",-1),Ge=n("label",null,"备注：",-1),Xe=ne({__name:"Detail",setup(y,{expose:M}){const L=fe(),F=p(),C=p(""),o=p({digitalHumanPerson:{},voiceSpeak:{}}),d=async()=>{let[f,c]=await z.get({url:`/api/digitalhuman/synthesis/${C.value}/view`});c&&(o.value=c||{})},w=()=>{L.push("/digital-human/edit")};return M({show({title:f,uuid:c}){C.value=c,F.value.show({width:1e3,showActions:!1,title:f}),d()}}),(f,c)=>{const k=q("Pane");return h(),V(k,{ref_key:"refPane",ref:F},{default:e(()=>[t(X,null,{default:e(()=>[t(D,{cols:"12",md:"6"},{default:e(()=>[t(G,null,{default:e(()=>[n("div",Ee,[n("video",{class:"w-100 h-100",src:(o.value.video,o.value.video),controls:"",poster:o.value.digitalHumanPerson.cover},null,8,Re)])]),_:1})]),_:1}),t(D,{cols:"12",md:"6"},{default:e(()=>[t(G,null,{default:e(()=>[n("div",Te,[n("h3",je,b(o.value.cname),1),t(x,{"hide-details":""},{prepend:e(()=>[He]),default:e(()=>[n("div",Qe,[t(ue,{size:"80",class:"mr-2",rounded:"0"},{default:e(()=>[n("img",{src:o.value.cover,class:"w-100"},null,8,Ke)]),_:1})])]),_:1}),t(x,{"hide-details":""},{prepend:e(()=>[Oe]),default:e(()=>[i(" 15s ")]),_:1}),t(x,{"hide-details":""},{prepend:e(()=>[Ze]),default:e(()=>[i(" 1.0 ")]),_:1}),t(x,{"hide-details":""},{prepend:e(()=>[Je]),default:e(()=>[i(" "+b(r(P).dateFormat(o.value.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(x,{"hide-details":""},{prepend:e(()=>[We]),default:e(()=>[i(" "+b(r(P).dateFormat(o.value.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(x,{"hide-details":""},{prepend:e(()=>[Ge]),default:e(()=>[i(" "+b(o.value.remark),1)]),_:1}),t(Y,{flat:"",color:"secondary",onClick:w},{default:e(()=>[i("去合成视频 >")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},512)}}});const U=y=>(re("data-v-14c46e74"),y=y(),ie(),y),et={class:"mx-auto mt-10",style:{width:"500px"}},tt=U(()=>n("label",{class:"required"},"预览图片",-1)),at=["src"],lt=U(()=>n("label",{class:"required"},"视频文件",-1)),ot={key:0,style:{"margin-left":"24%",width:"75%"}},st=U(()=>n("label",{class:"required"},"姓名 ",-1)),nt=U(()=>n("label",{class:"required"},"标识 ",-1)),dt=U(()=>n("label",{class:"required"},"性别 ",-1)),rt={class:"required"},it={class:"required"},ut={class:"required"},ct=U(()=>n("label",null,"备注",-1)),mt={__name:"PaneModelEstimate",props:{modelName:String},emits:["submit"],setup(y,{expose:M,emit:L}){const F=de(),C=y,o=H({operateType:"",disabledField:!1,disabledVal:!1,maxTokens:4096,file:"",formData:{coverFileId:"",videoFileId:"",name:"",cname:"",gender:"",resolution:"",remark:"",posture:"",pads:"0,0,0,0"},showDataSet:!1,upLoading:!1}),{formData:d,showDataSet:w}=_e(o),f=p(null),c=p(null),k=L,S=p(),E=p(),A=/^[a-zA-Z0-9_\u4e00-\u9fa5-]+$/,g=H({coverFileId:[l=>!!l||"请上传预览图片"],videoFileId:[l=>l&&l.length>0?!0:"请上传视频文件"],resolution:[l=>!!l||"请选择分辨率"],posture:[l=>!!l||"请选择姿势"],gender:[l=>!!l||"请选择性别"],name:[l=>l&&l.length>0?(l.length>1||l.length<=30)&&A.test(l)?!0:"请输入正确标识：中文、数字、字母、-、_":"请输入标识"],cname:[l=>l&&l.length>0&&l.length<30?!0:"请输入姓名"],pads:[l=>{if(l&&l.length>0){l=l.split(",");let a=/^(?!0)\d{1,4}$|^0$/,u=l.every(m=>a.test(m));return l.length==4&&u?!0:"请输入正整数边框充填值，比如:top,bottom,left,right"}else return"请输入边框充填"}]});F.options.speak_gender;const R=async(l={})=>{o.formData={...o.formData};const[a,u]=await z.post({...l,showSuccess:!0,url:"/api/digitalhuman/person/create",data:{...o.formData,modelName:C.modelName}});u&&(S.value.hide(),k("submit"))},N=async(l={})=>{const[a,u]=await z.put({...l,showSuccess:!0,url:`/api/digitalhuman/person/${o.formData.name}/update`,data:{...o.formData}});u&&(S.value.hide(),k("submit"))},I=l=>{o.showDataSet=l=="train"},Q=({valid:l,showLoading:a})=>{l&&(o.operateType=="add"?R({showLoading:a}):N({showLoading:a}))};M({show({title:l,infos:a={coverFileId:"",videoFileId:"",name:"",cname:"",gender:"",resolution:"",remark:"",posture:"",pads:"0,0,0,0"},operateType:u}){S.value.show({title:l,refForm:E,showActions:u!="view"}),o.formData=ee.pick(ee.cloneDeep(a),["videoFileId","name","cname","gender","resolution","remark","posture","pads","coverFileId"]),o.operateType=u,o.disabledVal=u=="view",o.disabledField=u!="add",u=="add"?(f.value=null,c.value=null,o.upLoading=!1):(f.value={s3Url:a.cover},c.value={s3Url:a.video})}});const K=()=>{d.value.coverFileId="",f.value=null},O=()=>{d.value.videoFileId="",c.value=null};return(l,a)=>{const u=q("Select"),m=q("Pane");return h(),V(m,{ref_key:"refPane",ref:S,class:"",onSubmit:Q},{default:e(()=>[n("div",et,[t(Ne,{ref_key:"refForm",ref:E,class:"my-form"},{default:e(()=>[t(x,{rules:g.coverFileId,modelValue:r(d).coverFileId,"onUpdate:modelValue":a[2]||(a[2]=s=>r(d).coverFileId=s),"hide-details":"auto",style:{position:"relative"}},{prepend:e(()=>[tt]),default:e(()=>[f.value&&f.value.s3Url?(h(),V(se,{key:0,color:"borderColor",variant:"text",density:"compact",style:{flex:"none"}},te({default:e(()=>[t(ue,{size:"80",rounded:"0"},{default:e(()=>[t(me,{transition:!1,src:f.value.s3Url,alt:"上传成功后的头像",cover:""},null,8,["src"])]),_:1})]),_:2},[o.disabledVal?void 0:{name:"close",fn:e(()=>[t(le,{class:"text-24 opacity-50 cursor-pointer",color:"textPrimary",onClick:K},{default:e(()=>[i("mdi-close-circle")]),_:1})]),key:"0"}]),1024)):(h(),V(Y,{key:1,color:"info",variant:"outlined","prepend-icon":"mdi-plus",stacked:""},{default:e(()=>[i("上传 "),t(oe,{accept:"image/*",modelValue:r(d).coverFileId,"onUpdate:modelValue":a[0]||(a[0]=s=>r(d).coverFileId=s),infos:f.value,"onUpdate:infos":a[1]||(a[1]=s=>f.value=s),style:{width:"114px",height:"102px",position:"absolute",top:"0",left:"-55%",opacity:"0"}},null,8,["modelValue","infos"])]),_:1}))]),_:1},8,["rules","modelValue"]),t(x,{rules:g.videoFileId,modelValue:r(d).videoFileId,"onUpdate:modelValue":a[6]||(a[6]=s=>r(d).videoFileId=s),"hide-details":"auto",style:{position:"relative",width:"100%"}},{prepend:e(()=>[lt]),default:e(()=>[c.value&&c.value.s3Url?(h(),V(se,{key:0,color:"borderColor",variant:"text",density:"compact",style:{flex:"none",width:"94%","max-height":"40vh"}},te({default:e(()=>[n("video",{src:c.value.s3Url,controls:"",style:{height:"100%",width:"100%"}},null,8,at)]),_:2},[o.disabledVal?void 0:{name:"close",fn:e(()=>[t(le,{class:"text-24 opacity-50 cursor-pointer",color:"textPrimary",onClick:O},{default:e(()=>[i("mdi-close-circle")]),_:1})]),key:"0"}]),1024)):(h(),V(Y,{key:1,color:"info",variant:"outlined","prepend-icon":"mdi-tray-arrow-up ",disabled:o.upLoading},{default:e(()=>[i(b(o.upLoading?"上传中...":"上传视频")+" ",1),t(oe,{accept:"video/*",modelValue:r(d).videoFileId,"onUpdate:modelValue":a[3]||(a[3]=s=>r(d).videoFileId=s),infos:c.value,"onUpdate:infos":a[4]||(a[4]=s=>c.value=s),onLoading:a[5]||(a[5]=s=>o.upLoading=s),style:{width:"146px",position:"absolute",top:"0",left:"-31%",opacity:"0"}},null,8,["modelValue","infos"])]),_:1},8,["disabled"]))]),_:1},8,["rules","modelValue"]),o.upLoading?(h(),T("div",ot,[t($e,{indeterminate:""})])):he("",!0),t(j,{type:"text",placeholder:"请输入姓名","hide-details":"auto",clearable:"",modelValue:r(d).cname,"onUpdate:modelValue":a[7]||(a[7]=s=>r(d).cname=s),rules:g.cname,disabled:o.disabledVal},{prepend:e(()=>[st]),_:1},8,["modelValue","rules","disabled"]),t(j,{type:"text",placeholder:"请输入标识","hide-details":"auto",clearable:"",modelValue:r(d).name,"onUpdate:modelValue":a[8]||(a[8]=s=>r(d).name=s),rules:g.name,disabled:o.disabledField},{prepend:e(()=>[nt]),_:1},8,["modelValue","rules","disabled"]),t(u,{density:"compact",variant:"outlined",placeholder:"请选择性别","hide-details":"auto",rules:g.gender,modelValue:r(d).gender,"onUpdate:modelValue":a[9]||(a[9]=s=>r(d).gender=s),clearable:"",mapDictionary:{code:"speak_gender"},onChange:I,disabled:o.disabledVal},{prepend:e(()=>[dt]),_:1},8,["rules","modelValue","disabled"]),t(u,{density:"compact",variant:"outlined",placeholder:"请选择姿势","hide-details":"auto",rules:g.posture,modelValue:r(d).posture,"onUpdate:modelValue":a[10]||(a[10]=s=>r(d).posture=s),clearable:"",mapDictionary:{code:"digitalhuman_posture"},onChange:I,disabled:o.disabledVal},{prepend:e(()=>[n("label",rt,[i("姿势 "),t(W,null,{default:e(()=>[i("数字人形象的姿势 ")]),_:1})])]),_:1},8,["rules","modelValue","disabled"]),t(u,{density:"compact",variant:"outlined",placeholder:"请选择分辨","hide-details":"auto",rules:g.resolution,modelValue:r(d).resolution,"onUpdate:modelValue":a[11]||(a[11]=s=>r(d).resolution=s),clearable:"",mapDictionary:{code:"digitalhuman_resolution"},onChange:I,disabled:o.disabledVal},{prepend:e(()=>[n("label",it,[i("分辨率 "),t(W,null,{default:e(()=>[i("上传视频的分辨率")]),_:1})])]),_:1},8,["rules","modelValue","disabled"]),t(j,{type:"text",placeholder:"请输入eg: top,bottom,left,right","hide-details":"auto",clearable:"",modelValue:r(d).pads,"onUpdate:modelValue":a[12]||(a[12]=s=>r(d).pads=s),rules:g.pads,disabled:o.disabledVal},{prepend:e(()=>[n("label",ut,[i("边框充填 "),t(W,null,{default:e(()=>[i("算法截取面部时的边框:上,下,左,右")]),_:1})])]),_:1},8,["modelValue","rules","disabled"]),t(Ae,{modelValue:r(d).remark,"onUpdate:modelValue":a[13]||(a[13]=s=>r(d).remark=s),modelModifiers:{trim:!0},placeholder:"请输入",disabled:o.disabledVal},{prepend:e(()=>[ct]),_:1},8,["modelValue","disabled"])]),_:1},512)])]),_:1},512)}}},pt=ce(mt,[["__scopeId","data-v-14c46e74"]]),B=y=>(re("data-v-f9aa63e2"),y=y(),ie(),y),ft={class:"card-list-item text-textPrimary text-decoration-none",href:"javascript: void(0)"},_t=["onClick"],ht={class:"text-subtitle-1 mt-1 text-medium-emphasis text-truncate",style:{height:"15px"}},vt={class:"d-flex align-center justify-space-between mt-2",style:{height:"32px"}},gt={class:"flex-1-1 d-flex justify-space-between text-medium-emphasis"},yt=B(()=>n("span",{class:"font-weight-bold"},"这是进行一项操作时必须了解的重要信息",-1)),bt=B(()=>n("br",null,null,-1)),Vt=B(()=>n("span",{class:"text-primary"},"删除",-1)),wt=B(()=>n("br",null,null,-1)),kt={class:"text-primary"},xt=B(()=>n("br",null,null,-1)),It=ne({__name:"characterList",setup(y){const M=de(),{loadDictTree:L,getLabels:F}=M,C=p({title:"形象列表"}),o=p([]),d=H({name:""}),w=p([]),f=p(0),c=p(),k=p(),S=p(),E=p(),A=p(),g=H({name:""}),R=p(),N=async(m={})=>{await L(["speak_gender","digitalhuman_posture"]);const[s,$]=await z.get({url:"/api/digitalhuman/person/list",showLoading:R.value.$el,data:{...d,...m}});$?(w.value=$.list||[],f.value=$.total):(w.value=[],f.value=0)},I=()=>{c.value.query({page:1})},Q=()=>[{text:"编辑",color:"info",icon:ze,key:"view"},{text:"下载",color:"success",icon:Be,key:"download"},{text:"删除",color:"error",icon:Ye,key:"delete"}],K=m=>{window.open(m.video)},O=({id:m},s)=>{g.name=s.name,m==="view"?k.value.show({title:"形象编辑",operateType:"edit",infos:s}):m==="download"?K(s):m==="delete"&&A.value.show({width:"400px"})},l=async(m={})=>{const[s,$]=await z.delete({...m,showSuccess:!0,url:`/api/digitalhuman/person/${g.name}/delete`});$&&(A.value.hide(),N())},a=()=>{k.value.show({title:"形象添加",operateType:"add"})},u=m=>{k.value.show({title:"形象详情",operateType:"view",infos:m})};return ve(()=>{N()}),(m,s)=>{const $=q("ButtonsInForm"),pe=q("NoData");return h(),T(J,null,[t(we,{title:C.value.title,breadcrumbs:o.value},null,8,["title","breadcrumbs"]),t(G,null,{default:e(()=>[t(X,null,{default:e(()=>[t(D,{cols:"12",lg:"3",md:"4",sm:"6"},{default:e(()=>[t(j,{density:"compact",modelValue:d.name,"onUpdate:modelValue":s[0]||(s[0]=_=>d.name=_),label:"请输入姓名","hide-details":"",clearable:"",variant:"outlined",onKeyup:ge(I,["enter"]),"onClick:clear":I},null,8,["modelValue","onKeyup"])]),_:1}),t(D,{cols:"12",lg:"3",md:"4",sm:"6"},{default:e(()=>[t($,null,{default:e(()=>[t(Y,{color:"primary",onClick:a},{default:e(()=>[i("添加形象")]),_:1})]),_:1})]),_:1}),t(D,{cols:"12"},{default:e(()=>[t(ke,null,{default:e(()=>[i(" 生成视频的时间可能会比较长，请耐心等待！ ")]),_:1})]),_:1}),t(D,{cols:"12"},{default:e(()=>[t(X,{ref_key:"listContentRef",ref:R,class:Z({"justify-center":w.value.length===0})},{default:e(()=>[w.value.length>0?(h(!0),T(J,{key:0},ae(w.value,_=>(h(),V(D,{cols:"12",lg:"3",md:"4",sm:"6"},{default:e(()=>[t(De,{elevation:"10",rounded:"md"},{default:e(()=>[n("a",ft,[t(me,{src:_.cover,height:"180px",cover:"",class:"rounded-t-md align-end text-right",onClick:v=>u(_)},null,8,["src","onClick"]),t(Fe,{class:"pa-5"},{default:e(()=>[n("h5",{class:"text-h5 text-truncate",onClick:v=>u(_)},b(_.cname)+" （ "+b(r(F)([["speak_gender",_.gender],["digitalhuman_posture",_.posture]],v=>v.length?v.join("-"):"未知"))+"） ",9,_t),n("p",ht,b(_.remark),1),n("div",vt,[n("div",gt,[n("span",null,b(r(P).dateFromNow(_.updatedAt).indexOf("后")==-1?r(P).dateFromNow(_.updatedAt):r(P).dateFromNow(_.updatedAt).substr(0,r(P).dateFromNow(_.updatedAt).length-1)+"前"),1)]),t(Y,{class:"ml-6",size:"x-small",color:"inherit",icon:"",variant:"text"},{default:e(()=>[t(r(qe),{width:"14","stroke-width":"1.5"}),t(Ce,{activator:"parent"},{default:e(()=>[t(Se,{density:"compact","onClick:select":v=>O(v,_)},{default:e(()=>[(h(!0),T(J,null,ae(Q(),v=>(h(),V(Pe,{key:v.key,value:v.key,"hide-details":"","min-height":"38"},{prepend:e(()=>[(h(),V(ye(v.icon),{size:16,class:Z(["mr-2",[`text-${v.color}`]])},null,8,["class"]))]),default:e(()=>[t(Ue,{class:Z([`text-${v.color}`])},{default:e(()=>[i(b(v.text),1)]),_:2},1032,["class"])]),_:2},1032,["value"]))),128))]),_:2},1032,["onClick:select"])]),_:2},1024)]),_:2},1024)])]),_:2},1024)])]),_:2},1024)]),_:2},1024))),256)):(h(),V(pe,{key:1}))]),_:1},8,["class"]),be(t(Me,{class:"mt-5",ref_key:"refPager",ref:c,"page-sizes":[12,24,42,64,128],total:f.value,onQuery:N},null,8,["total"]),[[Ve,w.value.length>0]])]),_:1})]),_:1})]),_:1}),t(Le,{ref_key:"refDialogLog",ref:E},null,512),t(Xe,{ref_key:"refDetail",ref:S},null,512),t(xe,{ref_key:"refConfirmDelete",ref:A,onSubmit:l},{text:e(()=>[yt,bt,i(" 此操作将会"),Vt,i("该形象"),wt,i(" 形象姓名："),n("span",kt,b(g.name),1),xt,i(" 你还要继续吗？ ")]),_:1},512),t(pt,{ref_key:"refPaneModelEstimate",ref:k,onSubmit:I},null,512)],64)}}});const Ht=ce(It,[["__scopeId","data-v-f9aa63e2"]]);export{Ht as default};
