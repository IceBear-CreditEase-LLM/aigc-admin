import{d as A,r as d,x as P,c as z,U as $,k as L,l as M,m as l,j as e,Y as Z,al as G,am as J,W as u,P as X,au as R,a1 as ee,$ as S,ak as se,Z as Q,_ as x,ac as ne,o as ie,S as de,av as E,Q as ce,n as O,aw as ue,F as pe}from"./utils-15090c58.js";import{_ as me}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-f6213a89.js";import{_ as H}from"./UiParentCard.vue_vue_type_script_setup_true_lang-0e150107.js";import{A as fe}from"./AlertBlock-c06c49ed.js";import{a5 as B,_ as te,V as _e}from"./index-24ceeda1.js";import{V as ye}from"./VTextarea-b1274484.js";import{V as he}from"./VForm-123b6ecf.js";import{_ as ve}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-77722b42.js";import{_ as be}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-3456f2c5.js";import{V as T}from"./VCol-e2fcfa86.js";import{V as le}from"./VRow-ab8e6ed5.js";import"./IconInfoCircle-03c84ef6.js";import"./VAlert-30650f94.js";import"./Confirm-aedf99ab.js";const U=_=>(G("data-v-7128444a"),_=_(),J(),_),ge=U(()=>u("label",{class:"required"},"字典编号",-1)),xe=U(()=>u("label",{class:"required"},"字典名称",-1)),ke=U(()=>u("label",{class:"required"},"字典键值",-1)),we=U(()=>u("label",{class:"required"},"字典排序",-1)),De=U(()=>u("label",{class:"required"},"值类型",-1)),Ve=U(()=>u("label",null,"字典备注",-1)),Ce=A({__name:"DictForm",props:{type:{default:"add"},parentId:{default:0}},setup(_,{expose:D}){const w={parentId:0,code:"",dictLabel:"",dictValue:"",dictType:null,sort:0,remark:""},p=_,o=d({...w}),y=d(),n=P({code:[t=>!!t||"请输入字典编号"],dictLabel:[t=>!!t||"请输入字典名称"],dictValue:[t=>!!t||"请输入字典键值"],sort:[t=>t!==""||"请输入字典排序"],dictType:[t=>!!t||"请选择值类型"]}),k=z(()=>p.type==="edit"),f=z(()=>k.value||p.type==="add"&&p.parentId!==0);return D({reset:(t={})=>{o.value={...w,...t}},setFormData:t=>{o.value={...t}},getFormData(){return{...o.value,parentId:p.parentId}},getRef(){return y.value}}),(t,i)=>{const b=$("Select");return L(),M(he,{ref_key:"refForm",ref:y,class:"my-form"},{default:l(()=>[e(B,{type:"text",placeholder:"请输入字典编号","hide-details":"auto",clearable:"",rules:n.code,modelValue:o.value.code,"onUpdate:modelValue":i[0]||(i[0]=m=>o.value.code=m),disabled:f.value},{prepend:l(()=>[ge]),_:1},8,["rules","modelValue","disabled"]),e(B,{type:"text",placeholder:"请输入字典名称","hide-details":"auto",clearable:"",rules:n.dictLabel,modelValue:o.value.dictLabel,"onUpdate:modelValue":i[1]||(i[1]=m=>o.value.dictLabel=m)},{prepend:l(()=>[xe]),_:1},8,["rules","modelValue"]),t.parentId!==0?(L(),M(B,{key:0,type:"text",placeholder:"请输入字典键值","hide-details":"auto",clearable:"",rules:n.dictValue,modelValue:o.value.dictValue,"onUpdate:modelValue":i[2]||(i[2]=m=>o.value.dictValue=m)},{prepend:l(()=>[ke]),_:1},8,["rules","modelValue"])):Z("",!0),e(B,{type:"number",placeholder:"请输入字典排序","hide-details":"auto",rules:n.sort,modelValue:o.value.sort,"onUpdate:modelValue":i[3]||(i[3]=m=>o.value.sort=m),modelModifiers:{number:!0}},{prepend:l(()=>[we]),_:1},8,["rules","modelValue"]),e(b,{placeholder:"请选择值类型",rules:n.dictType,mapDictionary:{code:"sys_dict_type"},modelValue:o.value.dictType,"onUpdate:modelValue":i[4]||(i[4]=m=>o.value.dictType=m)},{prepend:l(()=>[De]),_:1},8,["rules","modelValue"]),e(ye,{modelValue:o.value.remark,"onUpdate:modelValue":i[5]||(i[5]=m=>o.value.remark=m),modelModifiers:{trim:!0},placeholder:"请输入字典备注",clearable:""},{prepend:l(()=>[Ve]),_:1},8,["modelValue"])]),_:1},512)}}});const ae=te(Ce,[["__scopeId","data-v-7128444a"]]),$e={class:"mx-auto mt-3",style:{width:"540px"}},Ie=A({__name:"CreateDictPane",emits:["submit"],setup(_,{expose:D,emit:w}){const p=w,o=P({operateType:"add"}),y=d(),n=d(),k=async({showLoading:f})=>{const{valid:s}=await n.value.getRef().validate();if(s){const v=n.value.getFormData(),t={url:"",method:""};o.operateType=="add"?(t.url="/sys/dict",t.method="post"):(t.url=`/sys/dict/${v.id}`,t.method="put");const[i,b]=await R[t.method]({showLoading:f,showSuccess:!0,url:t.url,data:v});b&&(y.value.hide(),p("submit"))}else ee.warning("请处理页面标错的地方后，再尝试提交")};return D({show({title:f,operateType:s,infos:v}){y.value.show({title:f}),o.operateType=s,X(()=>{o.operateType==="add"?n.value.reset():n.value.setFormData(v)})}}),(f,s)=>{const v=$("Pane");return L(),M(v,{ref_key:"refPane",ref:y,onSubmit:k},{default:l(()=>[u("div",$e,[e(ae,{ref_key:"refDictForm",ref:n},null,512)])]),_:1},512)}}});function Fe(_,D,w){if(typeof _.animate>"u")return{finished:Promise.resolve()};let p;try{p=_.animate(D,w)}catch{return{finished:Promise.resolve()}}return typeof p.finished>"u"&&(p.finished=new Promise(o=>{p.onfinish=()=>{o(p)}})),p}const Te=_=>(G("data-v-7706e3d6"),_=_(),J(),_),Pe={class:"d-flex justify-space-between align-center w-100 pr-2 overflow-hidden"},Le={class:"text-truncate"},Se=["onClick"],Be=["onClick"],Re=Te(()=>u("br",null,null,-1)),Ue={class:"text-primary font-weight-black"},qe=A({__name:"ConfigDictPane",emits:["refresh"],setup(_,{expose:D,emit:w}){const p=w,o=d([]),y=d(),n=d(),k=d(),f=d(),s=P({type:"edit",parentId:0,title:"编辑"}),v=d(0),t=d(null),i=d(),b=P({id:null,currentLabel:""}),m=d(!1),I=async()=>{const[a,c]=await R.get({url:"/sys/dict",data:{parentId:v.value}});c&&(o.value=c.list||[],t.value||q(c.list[0]),X(()=>{F()}))},F=()=>{n.value.setCurrentKey(t.value)},q=a=>{s.title=`编辑（${a.dictLabel}）`,s.type="edit",t.value=a.id;const c={id:a.id,parentId:a.parentId,code:a.code,dictValue:a.dictValue,dictLabel:a.dictLabel,dictType:a.dictType,sort:a.sort,remark:a.remark};s.parentId=a.parentId,f.value.setFormData(c)},K=async()=>{const{valid:a}=await f.value.getRef().validate();if(a){const c=f.value.getFormData(),r={url:"",method:""};s.type=="add"?(r.url="/sys/dict",r.method="post"):(r.url=`/sys/dict/${c.id}`,r.method="put");const[j,W]=await R[r.method]({showLoading:k.value.$el,showSuccess:!0,url:r.url,data:c});W&&(await I(),s.type==="add"&&f.value.reset({code:c.code}),c.parentId===0&&s.type==="edit"&&(m.value=!0))}else ee.warning("请处理页面标错的地方后，再尝试提交")},h=a=>{s.title=`新增子项(${a.dictLabel})`,s.type="add",s.parentId=a.id,t.value=a.id,F(),f.value.reset({code:a.code}),C()},g=a=>{b.currentLabel=a.dictLabel,b.id=a.id,i.value.show({width:"450px",confirmText:b.currentLabel})},V=async(a={})=>{const[c,r]=await R.delete({...a,showSuccess:!0,url:`/sys/dict/${b.id}`});r&&(i.value.hide(),b.id===t.value&&(t.value=null),I())},C=()=>{k.value&&Fe(k.value.$el,[{transformOrigin:"center"},{transform:"scale(1.03)"},{transformOrigin:"center"}],{duration:150,easing:"cubic-bezier(0.4, 0, 0.2, 1)"})};function N(){t.value=null,m.value&&p("refresh")}return D({show({title:a,id:c}){y.value.show({width:900,showActions:!1,title:a}),v.value=c,m.value=!1,I()}}),(a,c)=>{const r=$("el-tree"),j=$("AiBtn"),W=$("Pane");return L(),M(W,{ref_key:"refPane",ref:y,onClose:N},{default:l(()=>[e(le,null,{default:l(()=>[e(T,{cols:"5"},{default:l(()=>[e(H,null,{default:l(()=>[e(r,{ref_key:"refTree",ref:n,data:o.value,"node-key":"id","default-expand-all":"","highlight-current":!0,"expand-on-click-node":!1,props:{label:"dictLabel"},onNodeClick:q},{default:l(({node:oe,data:Y})=>[u("span",Pe,[u("span",Le,S(oe.label),1),u("span",{class:"ml-2",onClick:c[0]||(c[0]=se(()=>{},["stop"]))},[u("a",{class:"link text-info",onClick:re=>h(Y)},"添加",8,Se),Y.parentId!==0?(L(),Q("a",{key:0,class:"link text-error ml-2",onClick:re=>g(Y)},"删除",8,Be)):Z("",!0)])])]),_:1},8,["data"])]),_:1})]),_:1}),e(T,{cols:"7"},{default:l(()=>[e(H,{class:"dict-card",ref_key:"refDictFormCard",ref:k,title:s.title},{action:l(()=>[e(j,{class:"ml-2",size:"small",color:"primary",variant:"flat",onClick:K},{default:l(()=>[x("提交")]),_:1})]),default:l(()=>[e(ae,{ref_key:"refDictForm",ref:f,type:s.type,parentId:s.parentId},null,8,["type","parentId"])]),_:1},8,["title"])]),_:1})]),_:1}),e(be,{ref_key:"refConfirmDelete",ref:i,onSubmit:V},{text:l(()=>[x(" 这是进行一项操作时必须了解的重要信息"),Re,x(" 您将要删除 "),u("span",Ue,S(b.currentLabel),1),x(" ，确定要继续吗？ ")]),_:1},512)]),_:1},512)}}});const Me=te(qe,[["__scopeId","data-v-7706e3d6"]]),Ae=u("span",{class:"text-primary"},"删除",-1),Ke=u("br",null,null,-1),Ne={class:"text-primary font-weight-black"},We=u("br",null,null,-1),at=A({__name:"dict",setup(_){const{getLabels:D,loadDictTree:w}=ne();w(["sys_dict_type"]);const p=d({title:"系统字典"}),o=d([{text:"系统管理",disabled:!1,href:"#"},{text:"系统字典",disabled:!0,href:"#"}]),y=P({code:"",label:""}),n=P({list:[],total:0}),k=d(),f=d(),s=d(),v=d(),t=P({id:null,currentCode:""}),i=h=>{let g=[];return g.push({text:"字典配置",color:"info",click(){K(h)}}),g.push({text:"删除",color:"error",click(){b(h)}}),g},b=h=>{t.currentCode=h.code,t.id=h.id,v.value.show({width:"450px",confirmText:t.currentCode})},m=async(h={})=>{const[g,V]=await R.delete({...h,showSuccess:!0,url:`/sys/dict/${t.id}`});V&&(v.value.hide(),I())},I=async(h={})=>{const[g,V]=await R.get({url:"/sys/dict",showLoading:s.value.el,data:{...y,...h}});V?(n.list=V.list||[],n.total=V.total):(n.list=[],n.total=0)},F=()=>{s.value.query({page:1})},q=()=>{k.value.show({title:"添加字典",operateType:"add"})},K=h=>{f.value.show({title:`字典配置（${h.dictLabel}）`,id:h.id})};return ie(()=>{I()}),(h,g)=>{const V=$("ButtonsInForm"),C=$("el-table-column"),N=$("ButtonsInTable"),a=$("TableWithPager"),c=de("copy");return L(),Q(pe,null,[e(me,{title:p.value.title,breadcrumbs:o.value},null,8,["title","breadcrumbs"]),e(H,null,{default:l(()=>[e(le,null,{default:l(()=>[e(T,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[e(B,{modelValue:y.code,"onUpdate:modelValue":g[0]||(g[0]=r=>y.code=r),label:"请输入字典编号","hide-details":"",clearable:"",onKeyup:E(F,["enter"]),"onClick:clear":F},null,8,["modelValue","onKeyup"])]),_:1}),e(T,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[e(B,{modelValue:y.label,"onUpdate:modelValue":g[1]||(g[1]=r=>y.label=r),label:"请输入字典名称","hide-details":"",clearable:"",onKeyup:E(F,["enter"]),"onClick:clear":F},null,8,["modelValue","onKeyup"])]),_:1}),e(T,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[e(V,null,{default:l(()=>[e(_e,{color:"primary",onClick:q},{default:l(()=>[x("添加字典")]),_:1})]),_:1})]),_:1}),e(T,{cols:"12"},{default:l(()=>[e(fe,null,{default:l(()=>[x("修改之后将实时生效，请谨慎操作！")]),_:1})]),_:1}),e(T,{cols:"12"},{default:l(()=>[e(a,{onQuery:I,ref_key:"tableWithPagerRef",ref:s,infos:n},{default:l(()=>[e(C,{label:"字典编号",width:"200px",prop:"code"},{default:l(({row:r})=>[ce((L(),Q("span",null,[x(S(r.code),1)])),[[c,r.code]])]),_:1}),e(C,{label:"字典名称",prop:"dictLabel",width:"150px"}),e(C,{label:"字典排序",prop:"sort",width:"100px"}),e(C,{label:"字典类型",width:"100px"},{default:l(({row:r})=>[u("span",null,S(O(D)([["sys_dict_type",r.dictType]])),1)]),_:1}),e(C,{label:"备注",prop:"remark","min-width":"200px"}),e(C,{label:"更新时间","min-width":"160px"},{default:l(({row:r})=>[x(S(O(ue).dateFormat(r.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(C,{label:"操作",width:"160px",fixed:"right"},{default:l(({row:r})=>[e(N,{buttons:i(r)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1}),e(ve,{ref_key:"refConfirmDelete",ref:v,onSubmit:m},{text:l(()=>[x(" 此操作将会"),Ae,x("正在使用的字典"),Ke,x(" 字典编号："),u("span",Ne,S(t.currentCode),1),We,x(" 你还要继续吗？ ")]),_:1},512),e(Ie,{ref_key:"createDictPaneRef",ref:k,onSubmit:F},null,512),e(Me,{ref_key:"configDictPaneRef",ref:f,onRefresh:I},null,512)],64)}}});export{at as default};
