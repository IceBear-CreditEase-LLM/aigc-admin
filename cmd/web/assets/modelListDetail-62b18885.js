import{_ as ie}from"./NavBack.vue_vue_type_script_setup_true_lang-400666b5.js";import{i as ue,c as me,U as k,k as g,l as V,m as e,j as t,_ as a,$ as m,Y as H,W as r,n as o,aw as E,al as G,am as K,x as U,z as Q,r as C,a8 as R,au as Y,d as O,ax as X,ac as ce,o as pe,Z as ee,ab as _e,F as te,D as z}from"./utils-15090c58.js";import{_ as Z}from"./UiParentCard.vue_vue_type_script_setup_true_lang-0e150107.js";import{_ as ae,ai as F,e as fe,V as j,a5 as ye}from"./index-24ceeda1.js";import{V as $}from"./VCol-e2fcfa86.js";import{V as le}from"./VRow-ab8e6ed5.js";import{_ as J}from"./Explain.vue_vue_type_style_index_0_lang-9177768e.js";import{_ as be}from"./UploadFile.vue_vue_type_script_setup_true_lang-4cfa6d0e.js";import{V as he}from"./VTextarea-b1274484.js";import{V as ve}from"./VForm-123b6ecf.js";import{_ as we}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-77722b42.js";import{_ as oe}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-3456f2c5.js";import{V as xe,a as ge,b as De,c as ke}from"./VWindowItem-7bde2366.js";import"./IconInfoCircle-03c84ef6.js";import"./VFileInput-01190dfb.js";import"./Confirm-aedf99ab.js";const A=v=>(G("data-v-9d6f267a"),v=v(),K(),v),Ve=A(()=>r("label",null,"供应",-1)),Ie=A(()=>r("label",null,"类型",-1)),Te=A(()=>r("label",null,"最长上下文",-1)),Se=A(()=>r("label",null,"微调",-1)),$e=A(()=>r("label",null,"参数量",-1)),Ce={style:{color:"#539bff"}},Me=A(()=>r("label",null,"创建时间",-1)),Ne=A(()=>r("label",null,"备注",-1)),Fe={__name:"ModelListDetailBaseInfo",setup(v){const I=ue("provideModelListDetail"),p=me(()=>I.rawData);return(u,_)=>{const s=k("router-link"),M=k("el-tooltip");return g(),V(le,{class:"my-form waterfall"},{default:e(()=>[t($,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(F,{"hide-details":""},{prepend:e(()=>[Ve]),default:e(()=>[a(" "+m(p.value.providerName),1)]),_:1})]),_:1}),t($,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(F,{"hide-details":""},{prepend:e(()=>[Ie]),default:e(()=>[a(" "+m(p.value.modelType),1)]),_:1})]),_:1}),t($,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(F,{"hide-details":""},{prepend:e(()=>[Te]),default:e(()=>[a(" "+m(p.value.maxTokens),1)]),_:1})]),_:1}),p.value.isFineTuning?(g(),V($,{key:0,xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(F,{"hide-details":""},{prepend:e(()=>[Se]),default:e(()=>[t(M,{content:"微调详情",placement:"top"},{default:e(()=>[t(s,{to:"/model/fine-tuning/detail?jobId="+p.value.jobId,class:"link"},{default:e(()=>[a(m(p.value.isFineTuning?"是":""),1)]),_:1},8,["to"])]),_:1})]),_:1})]),_:1})):H("",!0),t($,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(F,{"hide-details":""},{prepend:e(()=>[$e]),default:e(()=>[r("span",Ce,m(p.value.parameters)+"B",1)]),_:1})]),_:1}),t($,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(F,{"hide-details":""},{prepend:e(()=>[Me]),default:e(()=>[a(" "+m(o(E).dateFormat(p.value.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1})]),_:1}),t($,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(F,{"hide-details":""},{prepend:e(()=>[Ne]),default:e(()=>[a(" "+m(p.value.remark),1)]),_:1})]),_:1})]),_:1})}}},Be=ae(Fe,[["__scopeId","data-v-9d6f267a"]]);const se=v=>(G("data-v-3c0a1599"),v=v(),K(),v),Pe={class:"mx-auto mt-10",style:{width:"500px"}},Le={class:"required",style:{width:"100%"}},Ye=se(()=>r("label",{class:"required"},"上传验证集",-1)),Ae={class:"required",style:{width:"100%"}},Ue={class:"required"},He=se(()=>r("label",null,"备注",-1)),qe={__name:"PaneModelEstimate",props:{modelName:String},emits:["submit"],setup(v,{expose:I,emit:p}){const u=v,_=U({operateType:"",disabledField:!1,maxTokens:4096,formData:{datasetType:"",evalPercent:100,metricName:"",fileId:"",remark:""},showDataSet:!1}),{formData:s,showDataSet:M}=Q(_),N=C(null),B=p,T=C(),f=C(),S=(l,n,x,c)=>l!==""?l<n?`下限 ${n}`:l>x?`上限 ${x}`:!0:c,w=U({operateType:[l=>l&&l.length>0?!0:"请选择评估数据集"],fileId:[l=>!!l||"请选择微调文件"],datasetType:[l=>!!l||"请选择评估数据集"],metricName:[l=>!!l||"请选择评估指标"],evalPercent:[l=>S(l,1,101,"请输入评估数量")]}),b=async(l={})=>{_.formData={..._.formData};const[n,x]=await Y.post({...l,showSuccess:!0,url:"/api/models/eval",data:{..._.formData,modelName:u.modelName}});x&&(T.value.hide(),B("submit"))},y=l=>{N.value=l.filename},h=()=>{N.value=null,_.formData.fileId=""},P=l=>{_.showDataSet=l=="train"},W=({valid:l,showLoading:n})=>{l&&_.operateType=="add"&&b({showLoading:n})};return I({show({title:l,infos:n={fileId:"",datasetType:"train",metricName:"",remark:"",evalPercent:100},operateType:x}){T.value.show({title:l,refForm:f}),_.formData=R.pick(R.cloneDeep(n),["id","name","alias","datasetType","email","projectName","serviceName","remark"]),_.operateType=x,x=="add"?_.disabledField=!1:_.disabledField=!0}}),(l,n)=>{const x=k("Select"),c=k("Pane");return g(),V(c,{ref_key:"refPane",ref:T,class:"",onSubmit:W},{default:e(()=>[r("div",Pe,[t(ve,{ref_key:"refForm",ref:f,class:"my-form"},{default:e(()=>[t(x,{density:"compact",variant:"outlined",placeholder:"请选择评估数据集","hide-details":"auto",rules:w.datasetType,modelValue:o(s).datasetType,"onUpdate:modelValue":n[0]||(n[0]=d=>o(s).datasetType=d),clearable:"",disabled:_.disabledField,mapDictionary:{code:"model_eval_dataset_type"},onChange:P},{prepend:e(()=>[r("label",Le,[a("评估数据集 "),t(J,null,{default:e(()=>[a("默认是训练数据集，您可以自定义上传验证集")]),_:1})])]),_:1},8,["rules","modelValue","disabled"]),o(M)?H("",!0):(g(),V(F,{key:0,rules:w.fileId,modelValue:o(s).fileId,"onUpdate:modelValue":n[3]||(n[3]=d=>o(s).fileId=d),"hide-details":"auto",style:{position:"relative"}},{prepend:e(()=>[Ye]),default:e(()=>[N.value?(g(),V(fe,{key:0,closable:"",color:"info","onClick:close":h},{default:e(()=>[a(m(N.value),1)]),_:1})):(g(),V(j,{key:1,color:"info",variant:"outlined"},{default:e(()=>[a("选择文件 "),t(be,{"show-loading":"",label2:"上传微调文件",purpose:"fine-tune-eval",modelValue:o(s).fileId,"onUpdate:modelValue":n[1]||(n[1]=d=>o(s).fileId=d),"onUpload:success":y,onLoading:n[2]||(n[2]=d=>l.upLoading=d),style:{width:"92px",position:"absolute",top:"0",left:"-10%",opacity:"0"}},null,8,["modelValue"])]),_:1}))]),_:1},8,["rules","modelValue"])),o(M)?(g(),V(ye,{key:1,density:"compact",variant:"outlined",type:"number",placeholder:"请输入评估数量","hide-details":"auto",rules:w.evalPercent,modelValue:o(s).evalPercent,"onUpdate:modelValue":n[4]||(n[4]=d=>o(s).evalPercent=d),modelModifiers:{number:!0},disabled:_.disabledField,style:{width:"80%"}},{prepend:e(()=>[r("label",Ae,[a("评估数量(%) "),t(J,null,{default:e(()=>[a("数据集数量的百分比，默认100%")]),_:1})])]),_:1},8,["rules","modelValue","disabled"])):H("",!0),t(x,{density:"compact",variant:"outlined",placeholder:"请选择评估指标","hide-details":"auto",rules:w.metricName,modelValue:o(s).metricName,"onUpdate:modelValue":n[5]||(n[5]=d=>o(s).metricName=d),clearable:"",disabled:_.disabledField,mapDictionary:{code:"model_eval_metric"}},{prepend:e(()=>[r("label",Ue,[a("评估指标 "),t(J,null,{default:e(()=>[a("评估的方式")]),_:1})])]),_:1},8,["rules","modelValue","disabled"]),t(he,{modelValue:o(s).remark,"onUpdate:modelValue":n[6]||(n[6]=d=>o(s).remark=d),modelModifiers:{trim:!0},placeholder:"请输入"},{prepend:e(()=>[He]),_:1},8,["modelValue"])]),_:1},512)])]),_:1},512)}}},Ee=ae(qe,[["__scopeId","data-v-3c0a1599"]]),Re={class:""},je={class:"d-flex"},We={style:{width:"250px"},class:"mr-4"},Je={style:{width:"250px"}},Qe=r("span",null,"请先部署模型 ",-1),ze=r("span",{class:"text-primary"},"取消",-1),Ze=r("br",null,null,-1),Ge={class:"text-primary font-weight-black"},Ke=r("br",null,null,-1),Oe=r("br",null,null,-1),Xe={class:"text-primary font-weight-black"},et=O({__name:"TabModelEstimate",props:{showArrange:String,modelTitle:String},setup(v){const I=v,p=X(),{loadDictTree:u,getLabels:_}=ce(),s=C(),M=C(),N=C(),B=C(),T=C(),f=U({style:{},formData:{modelName:"",datasetType:""},showTooltip:!1,timer:null,tableInfos:{list:[],total:0},currentJobId:""}),S=U({status:"",datasetType:""}),w=U({id:null,currentLabel:""});Q(f);const b=()=>{M.value.show({title:"添加评估",operateType:"add"})},y=c=>{f.currentJobId=c.id,B.value.show({width:"450px",confirmText:f.currentJobId})},h=c=>{w.currentLabel=c.modelName,w.id=c.id,T.value.show({width:"450px",confirmText:w.currentLabel})},P=async(c={})=>{const[d,L]=await Y.delete({...c,showSuccess:!0,url:`/api/models/eval/${w.id}`});L&&(T.value.hide(),l())},W=async(c={})=>{const[d,L]=await Y.post({...c,showSuccess:!0,url:`/api/models/eval/${f.currentJobId}/cancel`});L&&(B.value.hide(),s.value.query())},l=async(c={})=>{await u(["model_eval_dataset_type","model_eval_metric"]);let{modelName:d}=p.query;const[L,q]=await Y.get({url:"/api/models/eval",showLoading:s.value.el,data:{modelName:d,...S,...c}});q?(f.tableInfos.total=q.total,f.tableInfos.list=q.list):(f.tableInfos.list=[],f.tableInfos.total=0)},n=()=>{s.value.query({page:1})},x=c=>{let d=[];return c.status=="pending"||c.status=="running"?d.push({text:"取消",color:"",click(){y(c)}}):d.push({text:"删除",color:"error",click(){h(c)}}),d};return pe(()=>{l()}),(c,d)=>{const L=k("Select"),q=k("el-tooltip"),ne=k("ButtonsInForm"),D=k("el-table-column"),de=k("ButtonsInTable"),re=k("TableWithPager");return g(),ee(te,null,[r("div",Re,[t(le,null,{default:e(()=>[t($,{cols:"12",class:"d-flex justify-space-between align-center",style:{height:"76px"}},{default:e(()=>[r("div",je,[r("div",We,[t(L,{onChange:n,label:"请选择评估状态",mapDictionary:{code:"model_eval_status"},modelValue:S.status,"onUpdate:modelValue":d[0]||(d[0]=i=>S.status=i)},null,8,["modelValue"])]),r("div",Je,[t(L,{onChange:n,label:"请选择评估方式",mapDictionary:{code:"model_eval_dataset_type"},modelValue:S.datasetType,"onUpdate:modelValue":d[1]||(d[1]=i=>S.datasetType=i)},null,8,["modelValue"])])]),t(q,{ref:"tooltipRef",visible:f.showTooltip,"popper-options":{modifiers:[{name:"computeStyles",options:{adaptive:!1,enabled:!1}}]},"auto-close":1,"virtual-ref":N.value,"virtual-triggering":"","popper-class":"singleton-tooltip"},{content:e(()=>[Qe]),_:1},8,["visible","virtual-ref"]),I.showArrange=="success"||I.showArrange=="running"?(g(),V(ne,{key:0},{default:e(()=>[t(j,{color:"primary",ref_key:"buttonRef",ref:N,onClick:b},{default:e(()=>[a("创建模型")]),_:1},512)]),_:1})):H("",!0)]),_:1}),t($,{cols:"12"},{default:e(()=>[t(re,{onQuery:l,ref_key:"refTableWithPager",ref:s,infos:f.tableInfos},{default:e(()=>[t(D,{label:"指标",width:"200px"},{default:e(({row:i})=>[a(m(o(_)([["model_eval_metric",i.metricName]])),1)]),_:1}),t(D,{label:"数据量",width:"200px"},{default:e(({row:i})=>[a(m(i.evalTotal),1)]),_:1}),t(D,{label:"评估数据集",width:"200px"},{default:e(({row:i})=>[a(m(o(_)([["model_eval_dataset_type",i.datasetType]])),1)]),_:1}),t(D,{label:"平均分",width:"200px"},{default:e(({row:i})=>[a(m(i.score),1)]),_:1}),t(D,{label:"进度",width:"200px"},{default:e(({row:i})=>[a(m(o(E).toPercent(i.progress,2)),1)]),_:1}),t(D,{label:"评估状态",width:"200px"},{default:e(({row:i})=>[a(m(o(_e).localData.local_trainStatus[i.status]),1)]),_:1}),t(D,{label:"备注",width:"200px"},{default:e(({row:i})=>[a(m(i.remark),1)]),_:1}),t(D,{label:"开始时间",width:"200px"},{default:e(({row:i})=>[a(m(o(E).dateFormat(i.startedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(D,{label:"耗时",width:"200px"},{default:e(({row:i})=>[a(m(o(E).dateFormat(i.duration,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(D,{label:"创建时间",width:"200px"},{default:e(({row:i})=>[a(m(o(E).dateFormat(i.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(D,{label:"操作","min-width":"120px",fixed:"right"},{default:e(({row:i})=>[t(de,{buttons:x(i)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),t(we,{ref_key:"refConfirmAbort",ref:B,onSubmit:W},{text:e(()=>[a(" 此操作将会"),ze,a("正在进行的模型评估"),Ze,a(" 任务ID："),r("span",Ge,m(f.currentJobId),1),Ke,a(" 你还要继续吗？ ")]),_:1},512),t(oe,{ref_key:"refConfirmDelete",ref:T,onSubmit:P},{text:e(()=>[a(" 这是进行一项操作时必须了解的重要信息"),Oe,a(" 您将要删除 "),r("span",Xe,m(w.currentLabel),1),a(" ，确定要继续吗？ ")]),_:1},512),t(Ee,{ref_key:"refPaneModelEstimate",ref:M,onSubmit:n,modelName:I.modelTitle},null,8,["modelName"])],64)}}});const tt=["innerHTML"],ht=O({__name:"modelListDetail",setup(v){const I=X(),p=C(),u=U({tabIndex:"2",style:{},formData:{},rawData:{modelName:"",deployStatus:""},confirmByClickInfo:{html:"",action:"",row:{}}}),{style:_,rawData:s,formData:M}=Q(u);z("provideModelListDetail",u),z("provideModelListDetailed",u),(async()=>{let{jobId:b}=I.query,[y,h]=await Y.get({showLoading:!0,url:`/api/models/${b}`});h&&(u.rawData=h)})();const B=(b={})=>{let{action:y,row:h}=u.confirmByClickInfo;y=="deploy"?T(h,b):y=="undeploy"&&f(h,b)},T=async(b,y)=>{let[h,P]=await Y.post({...y,showSuccess:!0,url:`/api/models/${b.id}/deploy`,data:{...u.formData,id:b.id}});P&&p.value.hide()},f=async(b,y)=>{let[h,P]=await Y.post({...y,showSuccess:!0,url:`/api/models/${b.id}/undeploy`,data:{...u.formData,id:b.id}});P&&p.value.hide()},S=()=>{R.assign(u.confirmByClickInfo,{html:"确认部署模型 <span class='text-primary mx-1  font-weight-black'>"+u.rawData.modelName+"</span>吗？",action:"deploy",row:u.rawData}),p.value.show({width:"350px"})},w=()=>{R.assign(u.confirmByClickInfo,{html:"确认卸载模型 <span class='text-primary mx-1  font-weight-black'>"+u.rawData.modelName+"</span>吗？",action:"undeploy",row:u.rawData}),p.value.show({width:"350px"})};return(b,y)=>(g(),ee(te,null,[t(ie,{backUrl:"/model/model-list/list"},{default:e(()=>[a("模型详情")]),_:1}),t(Z,{class:"mt-4"},{header:e(()=>[a(" 模型："+m(o(s).modelName),1)]),action:e(()=>[o(s).deployStatus=="success"||o(s).deployStatus=="running"?(g(),V(j,{key:0,flat:"",color:"secondary",onClick:w},{default:e(()=>[a("卸载")]),_:1})):H("",!0),o(s).deployStatus=="failed"?(g(),V(j,{key:1,flat:"",color:"secondary",onClick:S},{default:e(()=>[a("部署")]),_:1})):H("",!0)]),default:e(()=>[t(Be)]),_:1}),t(Z,{class:"mt-5"},{header:e(()=>[t(xe,{modelValue:u.tabIndex,"onUpdate:modelValue":y[0]||(y[0]=h=>u.tabIndex=h),"align-tabs":"start",color:"primary"},{default:e(()=>[t(ge,{value:2},{default:e(()=>[a("当前模型下的评估列表")]),_:1})]),_:1},8,["modelValue"])]),default:e(()=>[t(De,{modelValue:u.tabIndex,"onUpdate:modelValue":y[1]||(y[1]=h=>u.tabIndex=h)},{default:e(()=>[t(ke,{value:2},{default:e(()=>[t(et,{showArrange:o(s).deployStatus,modelTitle:o(s).modelName},null,8,["showArrange","modelTitle"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(oe,{ref_key:"refConfirmByClick",ref:p,onSubmit:B},{text:e(()=>[r("div",{innerHTML:u.confirmByClickInfo.html},null,8,tt)]),_:1},512)],64))}});export{ht as default};
