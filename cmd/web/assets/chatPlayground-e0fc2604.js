import{u as Z}from"./favicon-de574133.js";import{_ as G}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-f6213a89.js";import{d as J,ax as K,r as u,x as Q,c as X,k as y,l as O,m as n,j as e,_,Z as U,a5 as z,F as A,$ as ee,W as m,U as te,Y as ae,au as oe,al as se,am as le}from"./utils-15090c58.js";import{_ as ne}from"./ModelSelect.vue_vue_type_script_setup_true_lang-854043e9.js";import{a4 as D,a5 as F,L as j,a0 as re,_ as de}from"./index-24ceeda1.js";import{V as E}from"./VSlider-55ddc261.js";import{V as M}from"./VSheet-c59a91c2.js";import{S as ue,M as me}from"./index-d760f0c9.js";import{_ as ce}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-3456f2c5.js";import{V as ie}from"./VAlert-30650f94.js";import{V as pe}from"./VTextarea-b1274484.js";import"./Confirm-aedf99ab.js";const fe=m("h6",{class:"text-h6 mb-3"},"会话设置",-1),_e=J({__name:"Config",setup(v,{expose:P}){const T=K(),{modelName:C}=T.query,i=u(10),c=u(C?{modelName:C}:null),t=Q({maxTokens:512,temperature:0,topP:0}),h=X(()=>{var o;return[{key:"maxTokens",title:"最大响应数",max:((o=c.value)==null?void 0:o.maxTokens)??0,min:0,step:1},{key:"temperature",title:"温度",max:1,min:0,step:.1},{key:"topP",title:"TopP",max:1,min:0,step:.1}]}),V=d=>{const o=d.maxTokens;t.maxTokens=t.maxTokens>o?o:512};return P({getData:()=>{var d;return{sendHistoryCount:i.value,data:{model:(d=c.value)==null?void 0:d.modelName,...t}}}}),(d,o)=>(y(),O(M,null,{default:n(()=>[e(D,{class:"mb-2 font-weight-medium"},{default:n(()=>[_("模型")]),_:1}),e(ne,{modelValue:c.value,"onUpdate:modelValue":[o[0]||(o[0]=a=>c.value=a),V],"default-first-value":"","return-object":""},null,8,["modelValue"]),e(M,null,{default:n(()=>[fe,e(D,{class:"mb-2 font-weight-medium"},{default:n(()=>[_("包含过去的消息")]),_:1}),e(E,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=a=>i.value=a),color:"primary",max:20,min:0,step:"1","hide-details":"","thumb-label":""},{append:n(()=>[e(F,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=a=>i.value=a),modelModifiers:{number:!0},"hide-details":"","single-line":"",density:"compact",type:"number",max:20,min:0,style:{width:"80px"}},null,8,["modelValue"])]),_:1},8,["modelValue"]),(y(!0),U(A,null,z(h.value,a=>(y(),U(A,null,[e(D,{class:"mb-2 font-weight-medium"},{default:n(()=>[_(ee(a.title),1)]),_:2},1024),e(E,{modelValue:t[a.key],"onUpdate:modelValue":b=>t[a.key]=b,color:"primary",max:a.max,min:a.min,step:a.step,"hide-details":"","thumb-label":""},{append:n(()=>[e(F,{modelValue:t[a.key],"onUpdate:modelValue":b=>t[a.key]=b,modelModifiers:{number:!0},"hide-details":"","single-line":"",density:"compact",type:"number",max:a.max,min:a.min,step:a.step,style:{width:"80px"}},null,8,["modelValue","onUpdate:modelValue","max","min","step"])]),_:2},1032,["modelValue","onUpdate:modelValue","max","min","step"])],64))),256))]),_:1})]),_:1}))}}),I=v=>(se("data-v-3b5e7f49"),v=v(),le(),v),he={class:"chat-playground d-flex"},ge={class:"left-part pa-4 d-none d-md-block"},xe=I(()=>m("h4",{class:"text-h6 mb-6"},"助理设置",-1)),ye=I(()=>m("br",null,null,-1)),ve={class:"middle-part"},Ve=I(()=>m("h4",{class:"text-h6 pa-4"},"聊天会话",-1)),be={class:"right-part pa-4"},ke=I(()=>m("h4",{class:"text-h6 mb-6"},"配置",-1)),Te=J({__name:"chatPlayground",setup(v){const{scrollRef:P,scrollToBottom:T,scrollToBottomIfAtBottom:C}=Z(),i=u({title:"聊天操场"}),c=u(""),t=u([]),h=u(""),V=u(!1),$=u(),d=u(),o=()=>{const s=h.value;h.value="",a("text",s)},a=async(s,l,g={})=>{let r=l;const x=b(r);N({content:r,contentType:s,createdAt:new Date,ext:g,msgType:"question"}),T(),V.value=!0,N({loading:!0,content:"",contentType:"text",createdAt:new Date,msgType:"answer"}),T();try{await oe.post({url:"/channels/chat/completions",timeout:300*1e3,data:x,onDownloadProgress:p=>{const B=p.target,{responseText:w}=B,H=w.lastIndexOf(`
`,w.length-2);let q=w;H!==-1&&(q=w.substring(H));try{const k=JSON.parse(q),S=t.value.length-1;if(k.success){const f=k.data;L(S,{loading:!0,content:f.fullContent,contentType:f.contentType??"text",createdAt:f.createdAt,msgType:"answer"})}else{const f=t.value[S];if(f.content&&f.content!==""){R(S,{content:`${f.content}
[${k.message}]`,loading:!0});return}L(S,{loading:!0,content:k.message,contentType:"text",createdAt:new Date,msgType:"answer"})}C()}catch{}}})}catch(p){console.log(p)}finally{R(t.value.length-1,{loading:!1}),V.value=!1}},b=s=>{const l=$.value.getData(),g=l.data,r=l.sendHistoryCount*2;let x=[];const p=[{role:"system",content:c.value}];return r!==0&&(x=t.value.slice(-r)),x.forEach(B=>{p.push({role:"user",content:B.content})}),p.push({role:"user",content:s}),g.messages=p,g},N=s=>{t.value.push(s)},L=(s,l)=>{t.value[s]=l},R=(s,l)=>{t.value[s]={...t.value[s],...l}},W=()=>{d.value.show({width:"400px"})},Y=()=>{t.value=[],d.value.hide()};return(s,l)=>{const g=te("perfect-scrollbar");return y(),U(A,null,[e(G,{title:i.value.title},null,8,["title"]),e(re,{elevation:"10"},{default:n(()=>[m("div",he,[m("div",ge,[xe,e(ie,{class:"mb-3 text-body-2",color:"textPrimary",variant:"tonal"},{default:n(()=>[_("给模型提供指令，告诉它在生成响应时应该如何行为以及需要参考的上下文。你可以描述助手的个性，告诉它应该回答什么和不应该回答什么，并告诉它如何格式化响应。此部分没有令牌限制，但将包含在每个API调用中，因此会计入总令牌限制。"),ye,_('比如："你是一个 AI 助手，可帮助人们查找信息并以押韵的方式作出回应。如果用户问了你不知道答案的问题，就说出来。"')]),_:1}),e(M,null,{default:n(()=>[e(D,{class:"mb-2 font-weight-medium"},{default:n(()=>[_("系统消息")]),_:1}),e(pe,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=r=>c.value=r),variant:"outlined",placeholder:"可以给定助理角色及相关要求，不要超过2000个字",rows:"3","no-resize":"",color:"primary","row-height":"25",shaped:"","hide-details":""},null,8,["modelValue"])]),_:1})]),m("div",ve,[Ve,e(j),e(g,{ref_key:"scrollRef",ref:P,class:"middle-part__list"},{default:n(()=>[t.value.length>0?(y(!0),U(A,{key:0},z(t.value,(r,x)=>(y(),O(me,{key:x,"chat-item":r},null,8,["chat-item"]))),128)):ae("",!0)]),_:1},512),e(j),e(ue,{modelValue:h.value,"onUpdate:modelValue":l[1]||(l[1]=r=>h.value=r),onSubmit:o,onClear:W,"send-loading":V.value},null,8,["modelValue","send-loading"])]),m("div",be,[ke,e(_e,{ref_key:"configRef",ref:$},null,512)])])]),_:1}),e(ce,{ref_key:"refConfirmDelete",ref:d,onSubmit:Y},{text:n(()=>[_("确定清空会话？")]),_:1},512)],64)}}});const Le=de(Te,[["__scopeId","data-v-3b5e7f49"]]);export{Le as default};
