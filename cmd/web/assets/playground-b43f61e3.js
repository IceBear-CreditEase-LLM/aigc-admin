import{u as Q}from"./favicon-de574133.js";import{_ as X}from"./NavBack.vue_vue_type_script_setup_true_lang-400666b5.js";import{d as ee,ax as te,r as i,x as ae,o as oe,U as L,k as f,Z as S,j as a,m as s,_ as m,n as se,W as _,F as k,a5 as M,l as q,$ as le,Y as ne,au as P,al as re,am as de}from"./utils-15090c58.js";import{S as ue,M as ce}from"./index-d760f0c9.js";import{_ as ie}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-3456f2c5.js";import{_ as me}from"./ModelSelect.vue_vue_type_script_setup_true_lang-854043e9.js";import{V}from"./VSheet-c59a91c2.js";import{a4 as x,L as R,a0 as pe,_ as fe}from"./index-24ceeda1.js";import{V as z}from"./VTextarea-b1274484.js";import{V as _e}from"./VCheckbox-3e0659d6.js";import"./Confirm-aedf99ab.js";const E=h=>(re("data-v-6d4b0558"),h=h(),de(),h),he={class:"chat-playground d-flex h-100"},ge={class:"left-part pa-4 d-none d-md-block"},ve=E(()=>_("h4",{class:"text-h6 mb-6"},"助理设置",-1)),ye={class:"middle-part d-flex flex-column"},Ve=E(()=>_("h4",{class:"text-h6 pa-4"},"聊天会话",-1)),xe=ee({__name:"playground",setup(h){const{scrollRef:F,scrollToBottom:D,scrollToBottomIfAtBottom:J}=Q(),O=te(),{assistantId:w}=O.query;i({title:"助手操场"});const n=ae({toolIds:[],instructions:"",modelName:"",stream:!0}),l=i([]),g=i(""),C=i(!1),b=i(),I=i({}),T=i(""),j=()=>{const o=g.value;g.value="",W("text",o)},H=o=>{const e={...n},d=6*2;let u=[];const t=[{role:"system",content:T.value}];return u=l.value.slice(-d),u.forEach(r=>{t.push({role:"user",content:r.content})}),t.push({role:"user",content:o}),e.messages=t,e},W=async(o,e,d={})=>{let u=e;const t=H(u);N({content:u,contentType:o,createdAt:new Date,ext:d,msgType:"question"}),D(),C.value=!0,N({loading:!0,content:"",contentType:"text",createdAt:new Date,msgType:"answer"}),D();try{await P.post({url:`/assistants/${w}/playground`,timeout:300*1e3,data:t,onDownloadProgress:r=>{const K=r.target,{responseText:v}=K,U=v.lastIndexOf(`
`,v.length-2);let B=v;U!==-1&&(B=v.substring(U));try{const p=JSON.parse(B),y=l.value.length-1;if(p.success){const c=p.data;$(y,{loading:!0,content:c.fullContent,contentType:c.contentType||"text",createdAt:c.createdAt,msgType:"answer"})}else{const c=l.value[y];if(c.content&&c.content!==""){A(y,{content:`${c.content}
[${p.message}]`,loading:!0});return}$(y,{loading:!0,content:p.message,contentType:"text",createdAt:new Date,msgType:"answer"})}J()}catch{}}})}catch(r){console.log(r)}finally{A(l.value.length-1,{loading:!1}),C.value=!1}},N=o=>{l.value.push(o)},$=(o,e)=>{l.value[o]=e},A=(o,e)=>{l.value[o]={...l.value[o],...e}},Y=()=>{b.value.show({width:"400px"})},Z=()=>{l.value=[],b.value.hide()},G=async()=>{let[o,e]=await P.get({showLoading:!0,url:`/assistants/${w}`});e&&(I.value=e,n.instructions=e.instructions,n.modelName=e.modelName,n.toolIds=I.value.tools.map(d=>d.toolId))};return oe(()=>{G()}),(o,e)=>{const d=L("el-tooltip"),u=L("perfect-scrollbar");return f(),S(k,null,[a(X,{backUrl:`/ai-assistant/assistants/detail?assistantId=${se(w)}`},{default:s(()=>[m("助手操场")]),_:1},8,["backUrl"]),a(pe,{elevation:"10",class:"mt-4",style:{height:"calc(100vh - 188px)"}},{default:s(()=>[_("div",he,[_("div",ge,[ve,a(V,null,{default:s(()=>[a(x,{class:"mb-2 font-weight-medium"},{default:s(()=>[m("系统提示词")]),_:1}),a(z,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=t=>T.value=t),variant:"outlined",placeholder:"可以给定助理角色及相关要求，不要超过2000个字",rows:"3","no-resize":"",color:"primary","row-height":"25",shaped:""},null,8,["modelValue"])]),_:1}),a(V,null,{default:s(()=>[a(x,{class:"mb-2 font-weight-medium"},{default:s(()=>[m("指令")]),_:1}),a(z,{modelValue:n.instructions,"onUpdate:modelValue":e[1]||(e[1]=t=>n.instructions=t),variant:"outlined",placeholder:"请输入指令",rows:"6","no-resize":"",color:"primary","row-height":"25",shaped:""},null,8,["modelValue"])]),_:1}),a(V,null,{default:s(()=>[a(x,{class:"mb-2 font-weight-medium"},{default:s(()=>[m("模型")]),_:1}),a(me,{modelValue:n.modelName,"onUpdate:modelValue":e[2]||(e[2]=t=>n.modelName=t)},null,8,["modelValue"])]),_:1}),a(V,null,{default:s(()=>[a(x,{class:"mb-2 font-weight-medium"},{default:s(()=>[m("工具")]),_:1}),(f(!0),S(k,null,M(I.value.tools,t=>(f(),q(_e,{modelValue:n.toolIds,"onUpdate:modelValue":e[3]||(e[3]=r=>n.toolIds=r),color:"primary","hide-details":"",value:t.toolId},{label:s(()=>[a(d,{content:t.description,placement:"top"},{default:s(()=>[m(le(t.name),1)]),_:2},1032,["content"])]),_:2},1032,["modelValue","value"]))),256))]),_:1})]),_("div",ye,[Ve,a(R),a(u,{ref_key:"scrollRef",ref:F,class:"middle-part__list"},{default:s(()=>[l.value.length>0?(f(!0),S(k,{key:0},M(l.value,(t,r)=>(f(),q(ce,{key:r,"chat-item":t},null,8,["chat-item"]))),128)):ne("",!0)]),_:1},512),a(R),a(ue,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t),onSubmit:j,onClear:Y,"send-loading":C.value},null,8,["modelValue","send-loading"])])])]),_:1}),a(ie,{ref_key:"refConfirmDelete",ref:b,onSubmit:Z},{text:s(()=>[m("确定清空会话？")]),_:1},512)],64)}}});const Ue=fe(xe,[["__scopeId","data-v-6d4b0558"]]);export{Ue as default};
